# Reactç†å¿µ
> Reactæ˜¯ç”¨JavaScriptæ„å»º**å¿«é€Ÿå“åº”**çš„å¤§å‹Webåº”ç”¨ç¨‹åºçš„é¦–é€‰æ–¹å¼ã€‚
å‚è€ƒï¼š[https://react.iamkasong.com/preparation/idea.html](https://react.iamkasong.com/preparation/idea.html)


å…³é”®æ˜¯å®ç°`å¿«é€Ÿå“åº”`ã€‚é‚£ä¹ˆåˆ¶çº¦`å¿«é€Ÿå“åº”`çš„å› ç´ æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ

- å½“é‡åˆ°å¤§è®¡ç®—é‡çš„æ“ä½œæˆ–è€…è®¾å¤‡æ€§èƒ½ä¸è¶³ä½¿é¡µé¢æ‰å¸§ï¼Œå¯¼è‡´å¡é¡¿ã€‚
- å‘é€ç½‘ç»œè¯·æ±‚åï¼Œç”±äºéœ€è¦ç­‰å¾…æ•°æ®è¿”å›æ‰èƒ½è¿›ä¸€æ­¥æ“ä½œå¯¼è‡´ä¸èƒ½å¿«é€Ÿå“åº”ã€‚

è¿™ä¸¤ç±»åœºæ™¯å¯ä»¥æ¦‚æ‹¬ä¸ºï¼š

1. CPUçš„ç“¶é¢ˆ
2. IOçš„ç“¶é¢ˆ
## CPUçš„ç“¶é¢ˆ
> å°†é•¿ä»»åŠ¡åˆ†æ‹†åˆ°æ¯ä¸€å¸§ä¸­ï¼Œåƒèš‚èšæ¬å®¶ä¸€æ ·ä¸€æ¬¡æ‰§è¡Œä¸€å°æ®µä»»åŠ¡çš„æ“ä½œï¼Œè¢«ç§°ä¸ºâ€œ`æ—¶é—´åˆ‡ç‰‡`â€ï¼ˆtime sliceï¼‰

æµè§ˆå™¨çš„`GUIæ¸²æŸ“çº¿ç¨‹`å’Œ`JSçº¿ç¨‹`æ˜¯äº’æ–¥çš„ï¼Œæ‰€ä»¥**JSè„šæœ¬æ‰§è¡Œ**å’Œ**æµè§ˆå™¨å¸ƒå±€ã€ç»˜åˆ¶**ä¸èƒ½åŒæ—¶æ‰§è¡Œã€‚
å½“JSæ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œè¶…å‡ºäº†16.6msï¼Œè¿™æ¬¡åˆ·æ–°å°±æ²¡æœ‰æ—¶é—´æ‰§è¡Œæ ·å¼å¸ƒå±€å’Œæ ·å¼ç»˜åˆ¶ã€‚

æµè§ˆå™¨**æ¯ä¸€å¸§ï¼ˆ16.6msï¼‰**æ—¶é—´å†…ï¼Œéœ€è¦å®Œæˆå¦‚ä¸‹å·¥ä½œï¼š
`**JSè„šæœ¬æ‰§è¡Œï¼ˆ5msï¼‰ --> æ ·å¼å¸ƒå±€ --> æ ·å¼ç»˜åˆ¶**`

åœ¨Reactä¸­ç»™JSè„šæœ¬æ‰§è¡Œé¢„ç•™çš„åˆå§‹æ—¶é—´æ˜¯5msã€‚
```javascript
// é€šè¿‡ä½¿ç”¨ReactDOM.unstable_createRootå¼€å¯Concurrent Mode 
// ReactDOM.render(<App/>, rootEl); 
ReactDOM.unstable_createRoot(rootEl).render(<App/>);
```
```javascript
// åŒæ­¥æ›´æ–°
this.setState({})

// å¼‚æ­¥æ›´æ–°
import { unstable_scheduleCallback } from "scheduler";

unstable_scheduleCallback(()=>{
  this.setState({})
})
```
## IOçš„ç“¶é¢ˆ
`ç½‘ç»œå»¶è¿Ÿ`æ˜¯å‰ç«¯å¼€å‘è€…æ— æ³•è§£å†³çš„ã€‚å¦‚ä½•åœ¨`ç½‘ç»œå»¶è¿Ÿ`å®¢è§‚å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œå‡å°‘ç”¨æˆ·å¯¹`ç½‘ç»œå»¶è¿Ÿ`çš„æ„ŸçŸ¥ï¼Ÿ

ä¾‹å­ï¼šiosçš„è·¯ç”±è·³è½¬
ã€Siriä¸æœç´¢ã€‘é¡µé¢éœ€è¦ç­‰å¾…è¯·æ±‚æ•°æ®åå†æ˜¾ç¤ºç•Œé¢ï¼Œå¦‚æœä½¿ç”¨`loading`æ•ˆæœï¼ŒåŠæ—¶è¯·æ±‚æ—¶é—´å¾ˆçŸ­ï¼Œ`loading`æ•ˆæœä¸€é—ªè€Œè¿‡ç”¨æˆ·ä¹Ÿæ˜¯æœ‰æ„ŸçŸ¥çš„ã€‚
è€Œè‹¹æœçš„åšæ³•å°±æ˜¯åœ¨ç‚¹å‡»ã€Siriä¸æœç´¢ã€‘æ—¶å°±å¼€å§‹è¯·æ±‚æ•°æ®ï¼Œ**å¦‚æœæ—¶é—´è¿‡é•¿å†æ˜¾ç¤ºloadingæ•ˆæœï¼Œå¦‚æœæ—¶é—´è¾ƒçŸ­åˆ™å…ˆåœ¨å½“å‰é¡µé¢åœç•™ä¸€å°æ®µæ—¶é—´å†è·³è½¬**ã€‚

ä¸ºæ­¤ï¼ŒReactå®ç°äº†SuspenseåŠŸèƒ½åŠé…å¥—hook â€”â€” useDeferredValue
```javascript
import { Suspense, useDeferredValue } from 'react'

```

# Reactå’ŒVueåŒºåˆ«

1. Vueæ›´æ–°æ˜¯æ•°æ®**åŸå­çº§åˆ«**ï¼ŒReactæ˜¯**ç»„ä»¶çº§åˆ«**
2. Vueå¯¹éœ€è¦è¿½è¸ªçš„çŠ¶æ€ï¼Œä½¿ç”¨`getter`å’Œ`setter`è¿›è¡Œç»†ç²’åº¦æ•°æ®ä»£ç†ï¼Œä¸€æ—¦æ•°æ®æµä¹±äº†ï¼Œå¾ˆéš¾ä»ä¸­æ‹¦æˆªæ¸²æŸ“
3. Reactåˆ™åªå…³å¿ƒsetStateï¼Œæ›´åŠ ç²—ç²’åº¦ä½†æ˜¯æ›´å¥½æ§åˆ¶

# JSX

- **ä»€ä¹ˆæ˜¯JSXï¼Ÿ**

    - `JSX`å…¨ç§°åº”è¯¥ç¿»è¯‘ä¸º`JavaScript`çš„`XML`
    - ä»…ä»…æ˜¯`React.createElement(component, props, ...children)`å‡½æ•°çš„`è¯­æ³•ç³–`
    - babel loaderå·²å†…ç½®æ”¯æŒ.jsxæ–‡ä»¶


- **ä¸ºä»€ä¹ˆä½¿ç”¨JSXï¼Ÿ**

    - Reactè®¤ä¸ºæ¸²æŸ“é€»è¾‘æœ¬è´¨ä¸Šä¸å…¶ä»–UIé€»è¾‘å†…åœ¨è€¦åˆ
    - æ¯”å¦‚ï¼Œåœ¨UIä¸­éœ€è¦ç»‘å®šå¤„ç†äº‹ä»¶ã€åœ¨æŸäº›æ—¶åˆ»çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶éœ€è¦é€šçŸ¥åˆ°UIã€ä»¥åŠéœ€è¦åœ¨UIä¸­å±•ç¤ºå‡†å¤‡å¥½çš„æ•°æ®
    - å°†JSXå’ŒUIæ”¾åœ¨ä¸€èµ·ä¼šåœ¨è§†è§‰ä¸Šæœ‰è¾…åŠ©ä½œç”¨
> å¦‚æœä½ ä¸ä½¿ç”¨**JavaScript**æ‰“åŒ…å·¥å…·è€Œæ˜¯ç›´æ¥é€šè¿‡**<script />**æ ‡ç­¾åŠ è½½**React**çš„è¯ï¼Œ
> åˆ™å¿…é¡»å°†**React**æŒ‚åœ¨åˆ°**å…¨å±€å˜é‡**ä¸­ã€‚

 

- **å¸ƒå°”ç±»å‹ã€Nullä»¥åŠUndefinedå°†ä¼šå¿½ç•¥**
`false`,`null`,`undefined`å’Œ`true`æ˜¯åˆæ³•çš„å­å…ƒç´ ã€‚
ä½†å®ƒä»¬å¹¶ä¸ä¼šè¢«æ¸²æŸ“ã€‚
```jsx
<div />

<div></div>

<div>{false}</div>

<div>{null}</div>

<div>{undefined}</div>

<div>{true}</div>
```


- **æ•°å­—0ä¸ä¼šè¢«å¿½ç•¥**
```jsx
const arr = [];

arr.length && <div>123</div> // 0
```

# state

- **è¸©å‘ï¼šå…³äºstateå˜é‡å®šä¹‰**
å¦‚æœæ˜¯å¼•ç”¨ç±»å‹ï¼Œæå‰å®šä¹‰å˜é‡ä¸ä¼šè¢«åˆ›å»ºä¸€ä¸ªæ–°çš„å¼•ç”¨ï¼›
å¦‚æœæ˜¯åŸºæœ¬ç±»å‹ï¼Œå»ºè®®ä½¿ç”¨`this.state.xx`æ¥å–å€¼
```jsx
// bool: false
const { bool } = this.state;

this.setState({ bool: true }, () => {
  console.log(bool); // false(å› ä¸ºæ­¤æ—¶çš„boolæ˜¯ä¸€ä¸ªå…¨æ–°çš„å˜é‡)
  console.log(this.state.bool); // true
})
```
# Props
## propsçš„åªè¯»æ€§

- **çº¯å‡½æ•°**
ç»„ä»¶æ— è®ºæ˜¯ä½¿ç”¨**å‡½æ•°å£°æ˜**è¿˜æ˜¯é€šè¿‡**classå£°æ˜**ï¼Œ**éƒ½å†³ä¸èƒ½ä¿®æ”¹è‡ªèº«çš„props**ã€‚
æ‰€ä»¥ï¼Œæ‰€æœ‰Reactç»„ä»¶éƒ½å¿…é¡»åƒçº¯å‡½æ•°ä¸€æ ·ä¿æŠ¤å®ƒä»¬çš„propsä¸è¢«ä¿®æ”¹

## Render Props

- **æœ¯è¯­â€œrender propsâ€**
æ˜¯æŒ‡ä¸€ç§åœ¨Reactç»„ä»¶ä¹‹é—´ä½¿ç”¨ä¸€ä¸ª**å€¼ä¸ºå‡½æ•°**çš„propå…±äº«ä»£ç çš„ç®€å•æŠ€æœ¯
**ä¾‹å¦‚**ï¼šReact Router  
```jsx
    <Router>
      <Route path="/home" render={()=> <Home />} />
      <Route path="/login" component={Login} />
    </Router>
```

-  **render propæ˜¯ä¸€ä¸ªç”¨äºå‘ŠçŸ¥ç»„ä»¶éœ€è¦æ¸²æŸ“ä»€ä¹ˆå†…å®¹çš„å‡½æ•°prop**  
```jsx
    <Mouse render={mouse => (
       <Component {...this.props}  mouse={mouse} />
    )} />
```

-  `**this.props.children()**`**æ— æ³•ä¼ å…¥propsçš„è§£å†³æ–¹æ¡ˆ:**
å‚è€ƒ`react-motion` æˆ–è€…å‚è€ƒantd-rn`<Picker>`ç»„ä»¶,
ä½¿ç”¨`React.cloneElement`æ·»åŠ é¢å¤–å‚æ•°  
```jsx
    <Motion>
       {value => <Component value={value} />}
    </Motion>
```
```jsx
{ 
  children && typeof children !== "string" &&
  React.isValidElement(children) &&
  React.cloneElement(children,props:{
      extra:... //extra props
  })
}
```

-  React Hookä¸ºå…¶æ·»åŠ ç”Ÿå‘½å‘¨æœŸ
ä½¿ç”¨React.Componentçš„HOCåŒ…è£¹pure function 

# ç”Ÿå‘½å‘¨æœŸ

-  æŒ‚è½½
â€œmountâ€ 
-  å¸è½½
â€œunmountâ€ï¼Œä»DOMä¸­è¢«ç§»é™¤ 

è¿™äº›ç”Ÿå‘½å‘¨æœŸè¢«ç§»é™¤ï¼š

- `componentWillMoount`
- `componentWillRecieveProps`
- `componentWillUpdate`
åšå‡ºæ­¤å†³å®šçš„åŸå› æœ‰ä¸¤ä¸ªï¼š

1. è¿™ä¸‰ç§æ–¹æ³•ç»å¸¸è¢«é”™è¯¯åœ°ä½¿ç”¨ï¼Œå¹¶ä¸”æœ‰æ›´å¥½çš„é€‰æ‹©
2. å½“åœ¨Reactä¸­å®ç°**å¼‚æ­¥æ¸²æŸ“**æ—¶ï¼Œæ»¥ç”¨å®ƒä»¬å°†æ˜¯æœ‰é—®é¢˜çš„ï¼Œé”™è¯¯å¤„ç†çš„ä¸­æ–­è¡Œä¸ºå¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼
æ–°çš„**ä¸å®‰å…¨**ç‰ˆæœ¬å°†æ˜¯ï¼š

- `**UNSAFE_componentWillMount**`
ç”Ÿå‘½å‘¨æœŸæ‰§è¡Œé¡ºåºï¼š `willMount` -> `render` -> `didMount` -> `willUnmount`

**åªæœ‰åœ¨didMountè°ƒç”¨ä¹‹åReactæ‰ä¼šä¿è¯ç¨åè°ƒç”¨willUnmountï¼Œ
**æ‰€ä»¥åœ¨willMountä¸­æ“ä½œ** ä»»ä½•å‰¯ä½œç”¨æˆ–è®¢é˜… **éƒ½ä¼šé€ æˆ** å†…å­˜æº¢å‡ºï¼ˆæ­¤æ—¶åœ¨willUnmountæ‰§è¡Œå–æ¶ˆè®¢é˜…çš„è¡Œä¸ºåˆ™æ— æ³•è¢«æ‰§è¡Œï¼‰

**
- `**UNSAFE_componentWillReceiveProps**`
åœ¨`willReceivePorps`ä¸­è°ƒç”¨çˆ¶ç»„ä»¶æ”¹å˜`state`çš„å‡½æ•°æ—¶ä¼šè¿›å…¥æ­»å¾ªç¯

- `**UNSAFE_componentWillUpdate**`
å½“å‘ç”Ÿé‡æ–°æ¸²æŸ“æ—¶ï¼Œç”Ÿå‘½å‘¨æœŸæ‰§è¡Œé¡ºåº `willUpdate` -> `render` -> `didUpdate`

å¦‚æœåœ¨renderï¼ˆæ¸²æŸ“ã€è®¡ç®—ã€å†æ›´æ–°DOMå…ƒç´ ï¼‰æ—¶å‘ç”Ÿé˜»å¡ï¼ŒwillUpdateå’ŒdidUpdateä¼šå­˜åœ¨ä¸€å®šæ—¶é—´å·®ï¼›
willUpdateå†…ä¸å¯ä»¥æœ‰å’Œrenderç›¸å…³çš„æ•°æ®çš„æ“ä½œï¼Œæ¯”å¦‚å½“å‰è§†å›¾/æ»šåŠ¨æ¡ä½ç½®ç­‰

**ğŸš©Reactå°†å¼•å…¥ä¸€äº›æ–°çš„ç”Ÿå‘½å‘¨æœŸï¼š**

- `**static getDerivedStateFromProps(props, state)**`
`getDerivedStateFromProps`å°†å¤„ç† `willReceiveProps` å’Œ `didUpdate` æ‰€åšçš„äº‹æƒ…ï¼›
æ¯æ¬¡re-render**ä¹‹å‰**éƒ½ä¼šæ‰§è¡Œï¼ˆsetStateæˆ–è€…forceUpdateï¼‰
å®ƒåº”è¿”å›ä¸€ä¸ªå¯¹è±¡æ¥æ›´æ–°stateï¼Œå¦‚æœè¿”å›nullåˆ™ä¸æ›´æ–°ä»»ä½•å†…å®¹ 
   - æ›¿ä»£willReceivePropsçš„ç¼ºç‚¹æ˜¯ä¸èƒ½è®¿é—®this
   - ä½ å¯èƒ½ä¸éœ€è¦derived state(useDerivedState)æ¨¡å¼ï¼ˆè®©ç»„ä»¶åœ¨propså˜åŒ–æ—¶æ›´æ–°stateï¼‰
   - è¿™ä½¿å¾—ç»„ä»¶å®¹æ˜“æ··æ·†ï¼Œè¯¦è§ã€å®Œå…¨å—æ§ç»„ä»¶ã€‘å’Œã€å®Œå…¨ä¸å—æ§ç»„ä»¶ã€‘

- `**getSnapshotBeforeUpdate(prevProps, prevState)**`
`getSnapshotBeforeUpdate`å°†å¤„ç† `willUpdate` å’Œ `didUpdate` æ‰€åšçš„äº‹æƒ…ï¼›
å› ä¸ºrenderåªç»è¿‡äº†æ›´æ–°DOMè¿™ä¸€æ“ä½œ

- `**componentDidCatch(error, errorInfo)**`**æ‰“å°é”™è¯¯ä¿¡æ¯**
ä¼šåœ¨â€œæäº¤â€é˜¶æ®µè¢«è°ƒç”¨ï¼Œå¯ä»¥æ‰§è¡Œå…¶ä»–æ“ä½œ

- `**static getDerviedStateFromError(error)**`**å¤„ç†é”™è¯¯è¾¹ç•Œ
Error Boundariesï¼šéƒ¨åˆ†UIçš„JavaScripté”™è¯¯ä¸åº”è¯¥å¯¼è‡´æ•´ä¸ªåº”ç”¨å´©æºƒ
è¿”å›æœ€æ–°stateï¼ˆç›´æ¥ä¿®æ”¹stateï¼‰ï¼Œæ¸²æŸ“å¤‡ç”¨IU**
æ¸²æŸ“é˜¶æ®µè°ƒç”¨ï¼Œä¸å¯ä»¥æ‰§è¡Œå…¶ä»–æ“ä½œ

# Reactç‰ˆæœ¬å‡çº§å†ç¨‹
## React 15æ—©æœŸä¼˜åŒ–
### æ¶æ„
React15æ¶æ„å¯ä»¥åˆ†ä¸ºä¸¤å±‚ï¼š

- Reconcilerï¼ˆåè°ƒå™¨ï¼‰â€”â€” è´Ÿè´£æ‰¾å‡ºå˜åŒ–çš„ç»„å»º
- Rendererï¼ˆæ¸²æŸ“å™¨ï¼‰â€”â€” è´Ÿè´£å°†å˜åŒ–çš„ç»„ä»¶æ¸²æŸ“åˆ°é¡µé¢ä¸Š

ç¼ºç‚¹ï¼š
Reconcileråˆ°Rendereræ•´ä¸ªè¿‡ç¨‹æ˜¯åŒæ­¥çš„ã€‚ç”±äºé€’å½’æ‰§è¡Œï¼Œæ‰€ä»¥æ›´æ–°ä¸€æ—¦å¼€å§‹ä¸­é€”å°±æ— æ³•ä¸­æ–­ã€‚
**å½“å±‚çº§å¾ˆæ·±æ—¶ï¼Œé€’å½’æ›´æ–°æ—¶é—´è¶…è¿‡äº†16msï¼Œç”¨æˆ·äº¤äº’å°±ä¼šå¡é¡¿**ã€‚
```jsx
this.setState({
  count: this.state.count + 1
})

  <li>{1 * this.state.count}</li>
    <li>{2 * this.state.count}</li>
      <li>{3 * this.state.count}</li>

```
é€’å½’æ‰§è¡Œé¡ºåºï¼š

1. Reconcilerå‘ç°1éœ€è¦å˜ä¸º2ï¼Œé€šçŸ¥Renderer
2. Rendereræ›´æ–°DOMï¼Œ1å˜ä¸º2
3. Reconcilerå‘ç°2éœ€è¦å˜ä¸º4ï¼Œé€šçŸ¥Renderer
4. Rendereræ›´æ–°DOMï¼Œ2å˜ä¸º4
5. Reconcilerå‘ç°3éœ€è¦å˜ä¸º6ï¼Œé€šçŸ¥Renderer
6. Rendereræ›´æ–°DOMï¼Œ3å˜ä¸º6

ä¸€æ—¦ä¸Šé¢æŸä¸€æ­¥éª¤è¢«ä¸­æ–­ï¼Œåç»­å°±ä¸å†æ‰§è¡Œã€‚æ¯”å¦‚ç¬¬2æ­¥ä¸­æ–­äº†ï¼Œé¡µé¢æ˜¾ç¤ºçš„å°±æ˜¯`2 2 3`è€Œä¸æ˜¯`2 4 6`ï¼ˆæ›´æ–°ä¸å®Œå…¨ï¼ï¼‰

> ä¼˜åŒ–ä¸»è¦ä¾§é‡äºJSå±‚é¢


-  **virtual domçš„ create/diff**
   [https://github.com/Matt-Esch/virtual-dom](https://github.com/Matt-Esch/virtual-dom) 
   - `virtual-dom/h` json 2 dom treeï¼Œç¬¬3ä¸ªå‚æ•°ä¸ºå¯å˜å€¼
   - `virtual-dom/diff` var patches = diff(tree, newTree)
   - `virtual-dom/patch` æ´¾é€æ›´æ–°äº‹ä»¶ patch(rootNode, patches)
   - `virtual-dom/create-element` rootNode = createElement(tree)
-  **å‡å°‘ç»„ä»¶çš„å¤æ‚åº¦ï¼ˆStatelessï¼‰**
æ— çŠ¶æ€ç»„ä»¶ã€å“‘ç»„ä»¶ã€çº¯å‡½æ•° 
-  **å‡å°‘å‘ä¸‹diffçš„è§„æ¨¡ï¼ˆSCU shouldComponentUpdateï¼‰**
PureComponent 
-  **å‡å°‘diffçš„æˆæœ¬ï¼ˆimmutable.jsï¼‰**
å¼¥è¡¥JavaScript**æ²¡æœ‰ä¸å¯å˜æ•°æ®ç»“æ„**çš„é—®é¢˜ï¼Œ
æ·±copyçš„æ€§èƒ½ä¼˜åŒ–åº“ï¼ŒåŸç†æ˜¯ç‰ºç‰²ç©ºé—´æ¢æ—¶é—´ 

## React 16ä¼˜åŒ–
### æ¶æ„
React16æ¶æ„å¯ä»¥åˆ†ä¸ºä¸‰å±‚ï¼š

- Schedulerï¼ˆè°ƒåº¦å™¨ï¼‰â€”â€” è°ƒåº¦ä»»åŠ¡çš„ä¼˜å…ˆçº§ï¼Œé«˜ä¼˜ä»»åŠ¡å…ˆè¿›å…¥Reconciler
- Reconcilerï¼ˆåè°ƒå™¨ï¼‰â€”â€” è´Ÿè´£æ‰¾å‡ºå˜åŒ–çš„ç»„å»º
- Rendererï¼ˆæ¸²æŸ“å™¨ï¼‰â€”â€” è´Ÿè´£å°†å˜åŒ–çš„ç»„ä»¶æ¸²æŸ“åˆ°é¡µé¢ä¸Š


### Schedulerè°ƒåº¦å™¨
ç›¸è¾ƒäºReact15ï¼Œæ–°å¢äº†`**Scheduler**`ï¼ˆè°ƒåº¦å™¨ï¼‰ï¼ˆç‹¬ç«‹äºReactçš„åº“ï¼‰ï¼Œä»¥æµè§ˆå™¨æ˜¯å¦æœ‰å‰©ä½™æ—¶é—´ä½œä¸ºä»»åŠ¡ä¸­æ–­çš„æ ‡å‡†ã€‚
éƒ¨åˆ†æµè§ˆå™¨å¯ä»¥ç”¨`requestIdleCallback`,å½“æµè§ˆå™¨æœ‰å‰©ä½™æ—¶é—´æ—¶é€šçŸ¥æˆ‘ä»¬ã€‚ä½†æ˜¯ç”±äºä»¥ä¸‹å› ç´ 

- æµè§ˆå™¨å…¼å®¹æ€§
- è§¦å‘é¢‘ç‡ä¸ç¨³å®šã€‚æ¯”å¦‚æµè§ˆå™¨åˆ‡æ¢tabï¼Œä¹‹å‰tabæ³¨å†Œçš„`requestIdleCallback`è§¦å‘çš„é¢‘ç‡ä¼šå˜å¾—å¾ˆä½

æ‰€ä»¥Reactè‡ªè¡Œå®ç°äº†polyfillã€‚

é™¤äº†åœ¨ç©ºé—²æ—¶è§¦å‘å›è°ƒçš„åŠŸèƒ½å¤–ï¼ŒSchedulerè¿˜æä¾›äº†å¤šç§è°ƒåº¦ä¼˜å…ˆçº§ä»»åŠ¡è®¾ç½®ã€‚
```javascript
import { unstable_scheduleCallback } from "scheduler"
```

### Reconcileråè°ƒå™¨ renderé˜¶æ®µ
ä»15çš„é€’å½’æ”¹ä¸ºå¯ä»¥ä¸­æ–­çš„å¾ªç¯è¿‡ç¨‹ï¼ˆFiberæ¶æ„ï¼‰
```javascript
/** @noinline */
function workLoopConcurrent() {
  // Perform work until Scheduler asks us to yield
  while (workInProgress !== null && !shouldYield()) {
    workInProgress = performUnitOfWork(workInProgress);
  }
}
```
Reconcilerä¸Rendererä¸å†æ˜¯äº¤æ›¿å·¥ä½œï¼Œè€Œæ˜¯åœ¨è™šæ‹ŸDOMä¸­ä»¥æ ‡è®°çš„å½¢å¼å­˜åœ¨ã€‚
å½“æ‰€æœ‰ç»„ä»¶éƒ½å®ŒæˆReconcilerï¼Œæ‰ä¼šç»Ÿä¸€äº¤ç»™Rendererã€‚
```javascript
export const Placement = /*             */ 0b0000000000010;
export const Update = /*                */ 0b0000000000100;
export const PlacementAndUpdate = /*    */ 0b0000000000110;
export const Deletion = /*              */ 0b0000000001000;
```

### Rendereræ¸²æŸ“å™¨ commité˜¶æ®µ
ç”±äºä¹‹å‰çš„ Scheduler -> Reconciler éƒ½æ˜¯åœ¨å†…å­˜ä¸­æ‰§è¡Œï¼Œæ‰€ä»¥å³ä½¿è¢«ä¸­æ–­

- æœ‰å…¶ä»–æ›´é«˜ä¼˜å…ˆçº§ä»»åŠ¡éœ€è¦å…ˆæ›´æ–°
- å½“å‰å¸§æ²¡æœ‰å‰©ä½™æ—¶é—´

ä¹Ÿä¸ä¼šæ›´æ–°é¡µé¢ä¸Šçš„DOM
![image.png](https://cdn.nlark.com/yuque/0/2023/png/674941/1685604822128-10be8dd6-f00f-4c9c-bd3c-82f926539ec0.png#averageHue=%23f7f7f7&clientId=u79aef8a1-19f4-4&from=paste&height=303&id=ufbcb1ab0&originHeight=986&originWidth=2290&originalType=binary&ratio=1&rotation=0&showTitle=false&size=282786&status=done&style=none&taskId=ud3f6cde1-fd5d-4d37-9e96-1bba908d5a6&title=&width=704)

### Fiberå¿ƒæ™ºæ¨¡å‹
`**å¿ƒæ™ºæ¨¡å‹**`ï¼šåœ¨ç°æœ‰ä¸šåŠ¡ä»£ç å·²å­˜åœ¨çš„æƒ…å†µä¸‹å¦‚ä½•**å®ç°å¼‚æ­¥å¯ä¸­æ–­**

- å¦‚æœä½¿ç”¨`async/await`ä¼šå­˜åœ¨ä¼ æŸ“æ€§ï¼Œå³ä¹‹å‰çš„åŒæ­¥å‡½æ•°ä»£ç ä¹Ÿè¦è¢«è¿«æ”¹æˆasyncå‡½æ•°ï¼›
- å¦‚æœä½¿ç”¨`Generator`ï¼Œå¯ä»¥ä¸­æ–­ä½†æ˜¯ä¹‹å‰çš„è®¡ç®—éœ€è¦é‡æ–°è®¡ç®—ï¼Œ
å¦‚æœä½¿ç”¨`å…¨å±€å˜é‡`ä¿å­˜ä¹‹å‰æ‰§è¡Œçš„`ä¸­é—´çŠ¶æ€`ï¼Œåˆä¼šå¼•å…¥æ–°çš„å¤æ‚åº¦
- ä»£æ•°æ•ˆåº”ï¼šèƒ½å¤Ÿå°†å‰¯ä½œç”¨ä»å‡½æ•°é€»è¾‘ä¸­åˆ†ç¦»ï¼Œä½¿å‡½æ•°å…³æ³¨ç‚¹ä¿æŒçº¯ç²¹

åœ¨React15åŠä»¥å‰ï¼ŒReconcileré‡‡ç”¨é€’å½’çš„æ–¹å¼åˆ›å»ºè™šæ‹ŸDOMï¼Œé€’å½’è¿‡ç¨‹ä¸å¯ä¸­æ–­ã€‚
åŸºäºä¸Šè¿°å¿ƒæ™ºæ¨¡å‹ä¸å¦‚ç›´æ¥åœ¨React16ä¸­è®²è¿™ç§æ¶æ„é‡æ„æˆ`**Fiberæ ‘ + å¾ªç¯Reconciler**`

1. **Fiberæ ‘ç›¸å¯¹äºä¹‹å‰çš„è™šæ‹ŸDOMæ ‘ç»“æ„ä¸Šä»**`**æ ‘**`**æ”¹é€ æˆäº†**`**é“¾è¡¨**`**ï¼Œæœ‰äº†ä¸Šä¸‹å…³ç³»ï¼Œè¿™ä½¿å¾—å¯ä»¥å¾ªç¯éå†FiberèŠ‚ç‚¹ï¼›**
2. **ä½œä¸ºé™æ€çš„æ•°æ®ç»“æ„ï¼Œæ¯ä¸ªFiberèŠ‚ç‚¹å¯¹åº”ä¸€ä¸ªReact element**
3. **ä½œä¸ºåŠ¨æ€çš„å·¥ä½œä½†æ„¿ï¼Œæ¯ä¸ªFiberèŠ‚ç‚¹ä¿å­˜äº†æœ¬æ¬¡æ›´æ–°ä¸­æ”¹ç»„ä»¶æ”¹å˜çš„çŠ¶æ€ã€è¦æ‰§è¡Œçš„å·¥ä½œï¼ˆåˆ é™¤/æ’å…¥/æ›´æ–°ï¼‰**
```javascript
// æŒ‡å‘çˆ¶çº§FiberèŠ‚ç‚¹
this.return = null;
// æŒ‡å‘å­FiberèŠ‚ç‚¹
this.child = null;
// æŒ‡å‘å³è¾¹ç¬¬ä¸€ä¸ªå…„å¼ŸFiberèŠ‚ç‚¹
this.sibling = null;
```


**åŒç¼“å­˜Fiberæ ‘**
`canvas`ç»˜åˆ¶åŠ¨ç”»ï¼Œæ¯ä¸€å¸§ç»˜åˆ¶å‰éƒ½ä¼šè°ƒç”¨`ctx.clearRect`æ¸…é™¤ä¸Šä¸€å¸§çš„ç”»é¢ï¼Œç„¶åå®Œå…¨é‡æ–°ç»˜åˆ¶å½“å‰å¸§ï¼›
å¦‚æœç”»é¢è®¡ç®—é‡è¾ƒå¤§ï¼Œå¯¼è‡´æ¸…é™¤ä¸Šä¸€å¸§åˆ°ç»˜åˆ¶ä¸‹ä¸€é˜µç”»é¢ä¹‹é—´æœ‰è¾ƒé•¿é—´éš™ï¼Œå°±ä¼šå‡ºç°ç™½å±ã€‚
ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å†…å­˜ä¸­ç»˜åˆ¶å½“å‰å¸§åŠ¨ç”»ï¼Œç»˜åˆ¶å®Œæ¯•åç›´æ¥ç”¨å½“å‰å¸§æ›¿æ¢ä¸Šä¸€å¸§ç”»é¢ï¼Œçœå»äº†ä¸¤å¸§æ›¿æ¢é—´çš„è®¡ç®—æ—¶é—´ï¼Œå°±ä¸ä¼šå‡ºç°ç™½å±å†åˆ°ç”»é¢å‡ºç°çš„é—ªçƒæƒ…å†µã€‚

è¿™ç§åœ¨å†…å­˜ä¸­æ„å»ºå¹¶ç›´æ¥æ›¿æ¢çš„æŠ€æœ¯å«åšåŒç¼“å­˜ã€‚

> å°†ä¼˜åŒ–å‡çº§åˆ°æµè§ˆå™¨æ¸²æŸ“æœºåˆ¶å±‚é¢ï¼Œåœ¨patchä¸Šå–å¾—äº†çªç ´

-  **æµè§ˆå™¨æ¸²æŸ“æœºåˆ¶**
æµè§ˆå™¨æ˜¯å•çº¿ç¨‹çš„ï¼ˆQ:ä¸ºä»€ä¹ˆæ˜¯å•çº¿ç¨‹çš„ï¼ŸA:æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªçº¿ç¨‹è¦å¯¹è¿™èŠ‚ç‚¹è¿›è¡Œç§»é™¤ï¼Œ
ä¸€ä¸ªè¦å¯¹å®ƒè¿›è¡Œæ ·å¼æ“ä½œã€‚çº¿ç¨‹æ˜¯å¹¶å‘çš„ï¼Œæ— æ³•å†³å®šé¡ºåºï¼Œè¿™æ ·çš„é¡µé¢æ˜¯ä¸å¯æ§çš„ã€‚æ¢å•çº¿ç¨‹åˆ™ç®€å•å¯æ§ï¼‰ 
-  **EventLoop**
åœ¨å•çº¿ç¨‹ä¸­ï¼Œè§†å›¾æ¸²æŸ“ä¸èµ„æºåŠ è½½ã€äº‹ä»¶å›è°ƒæ˜¯å¦‚ä½•è°ƒåº¦çš„å‘¢ï¼Œå°±æ˜¯ä¾æ‰˜EventLoop
æµè§ˆå™¨çš„EventLoopæœ‰ä¸€ä¸ªè¦ç‚¹ï¼Œå¦‚æœä¸€ä¸‹å­åˆ†é…å®ƒè®¸å¤šä»»åŠ¡ï¼Œå®ƒçš„å¤„ç†é€Ÿåº¦å°±ä¸‹é™ã€‚
å¦‚æœæŠŠç›¸åŒçš„ä»»åŠ¡æ”¾åœ¨ä¸€èµ·ï¼Œå®ƒå°±é€Ÿåº¦ä¸Šå»äº†ï¼ˆè¿™æ˜¯æµè§ˆå™¨çš„åº•å±‚ä¼˜åŒ–JITï¼ˆjust-in-timeå³æ—¶ç¼–è¯‘ï¼‰ä¼˜åŒ–ï¼‰
æ€»ç»“ä¸ºï¼šä»»åŠ¡åˆ†ç‚¼ã€æ—¶é—´åˆ†ç‰‡ï¼ˆåˆ©ç”¨æµè§ˆå™¨è‡ªå¸¦çš„`requestIdleCallback`ï¼‰ã€å¼‚æ­¥æ¸²æŸ“ã€èŠ‚ç‚¹åˆå¹¶ 
-  **Filberè°ƒåº¦ç®—æ³•**`virtual-dom/patch`
åˆ†ä¸¤ä¸ªé˜¶æ®µï¼šç¬¬ä¸€ä¸ªé˜¶æ®µåˆ›å»ºDOMï¼Œæ‰§è¡ŒwillXXXè½»é‡hookï¼Œå¹¶ä¸”æ ‡è®°å®ƒçš„å„ç§å¯èƒ½ä»»åŠ¡ï¼ˆsadeEffectï¼‰
ç¬¬äºŒä¸ªé˜¶æ®µæ‰æ‰§è¡Œå®ƒä»¬ã€‚è¿™æ—¶å®ƒä¼š**ä¼˜å…ˆ**è¿›è¡ŒDOMæ’å…¥æˆ–ç§»åŠ¨æ“ä½œï¼Œ**ç„¶å**æ˜¯å±æ€§æ ·å¼æ“ä½œï¼ŒdidXXXé‡å‹hookï¼Œref
åŒæ­¥æ¨¡å¼ï¼šå…¶ä¸­**å…ˆæ“ä½œDOMï¼Œå†è®¾ç½®å±æ€§**å°±æ˜¯ä¸€ä¸ªéå¸¸å¤§çš„ä¼˜åŒ–ã€‚
å¼‚æ­¥æ¨¡å¼ï¼šæ—¶é—´åˆ†ç‰‡ã€‚EventLoopåœ¨ç¹å¿™çŠ¶æ€ä¸‹ä¼šè®©é¡µé¢å¡é¡¿ä½æ•ˆï¼Œäºæ˜¯ä½¿ç”¨`requestIdleCallback`æ—¶é—´è°ƒåº¦å™¨è‡ªåŠ¨åˆ†é…ã€‚ 


## React 16ä¹‹å‰çš„ç—›ç‚¹ä»¥åŠä¼˜åŒ–
**ç—›ç‚¹**

- **ç»„ä»¶ä¸èƒ½è¿”å›æ•°ç»„**ï¼Œå¸¸è§çš„åœºåˆæ˜¯`UL`å…ƒç´ ä¸‹åªèƒ½ä½¿ç”¨`LI`
- **å¼¹çª—é—®é¢˜**ï¼Œä¹‹å‰ä½¿ç”¨`unstable_renderSubtreeIntoContainer`
- **å¼‚å¸¸å¤„ç†**ï¼Œ`React DevTool`
- **HOCæµè¡Œå¸¦æ¥ä¸¤ä¸ªé—®é¢˜**ï¼š`ref`å’Œ`context`çš„å‘ä¸‹ä¼ é€’
- **ç»„ä»¶çš„æ€§èƒ½ä¼˜åŒ–**å…¨é `shouldCompoentnUpdate`SCU

**è§£å†³è¿›åº¦**

- 16.0
- **ç»„ä»¶è¿”å›ä»»æ„æ•°ç»„ç±»å‹**ï¼š`React.Children.toArray()`
- **å¼¹çª—é—®é¢˜**ï¼šæ¨å‡º`ReactDOM.createPortal()`
- **å¼‚å¸¸å¤„ç†**ï¼šæ¨å‡º`componentDidCatch`åˆ’åˆ†å‡ºé”™è¯¯ç»„ä»¶ä¸è¾¹ç•Œç»„ä»¶ï¼Œ**æ¯ä¸ªè¾¹ç•Œç»„ä»¶èƒ½ä¿®å¤ä¸‹æ–¹ç»„ä»¶é”™è¯¯ä¸€æ¬¡**
å†æ¬¡å‡ºé”™ï¼Œè½¬äº¤æ›´ä¸Šå±‚çš„è¾¹ç•Œç»„ä»¶æ¥å¤„ç†ï¼Œè§£å†³å¼‚å¸¸å¤„ç†é—®é¢˜ã€‚
- 16.2
- æ¨å‡º`Fragment`ç»„ä»¶
- 16.3
- **HOCæµè¡Œå¸¦æ¥ä¸¤ä¸ªé—®é¢˜**ï¼šæ¨å‡º`createRef`ä¸`forwardRef`è§£å†³Refåœ¨HOCä¸­çš„ä¼ é€’é—®é¢˜
æ¨å‡ºnew Context APIè§£å†³HOCçš„contextä¼ é€’é—®é¢˜ï¼ˆ[ä¸»è¦æ˜¯SCUä½œç¥Ÿ](https://www.jianshu.com/p/e53a37ddc365)ï¼‰

## React 17
å¯èƒ½æ˜¯React15åˆ°16çš„ä¸å…¼å®¹å˜æ›´å¤ªå¤šï¼Œå¼€å‘è€…ä»¬å‡çº§ç›¸å½“ç—›è‹¦ï¼Œæ‰€ä»¥å¾ˆé•¿ä¸€æ®µæ—¶é—´Reactå¼€å‘è€…éƒ½æ²¡æœ‰å†å‘å¸ƒæ–°ç‰ˆæœ¬ï¼Œè€Œæ˜¯åœ¨ v16 ä¸Šé›†æˆå„ç§æ–°èƒ½åŠ›ï¼Œ16.3/16.8/16.12 å‡ ä¹æ¯éš”å‡ ä¸ªç‰ˆæœ¬å°±æœ‰ä¸€é¢—èµ›è‰‡çš„æ–°ç‰¹æ€§å‡ºç°ã€‚

åœ¨é•¿è¾¾2å¹´åŠçš„ v16 ç‰ˆæœ¬åï¼ŒReactå›¢é˜Ÿå‘å¸ƒäº† v17ï¼Œ**åŒæ—¶å®£å¸ƒè¿™ä¸€ç‰ˆæœ¬çš„å®šä½æ˜¯ä¸€ç‰ˆæŠ€æœ¯æ”¹é€ çš„è¿‡æ¸¡ç‰ˆæœ¬**ï¼Œä¸»è¦ç›®æ ‡æ˜¯é™ä½åç»­ç‰ˆæœ¬çš„å‡çº§æˆæœ¬ã€‚
åœ¨ v17 ä¹‹å‰ï¼Œä¸åŒç‰ˆæœ¬çš„ React æ— æ³•æ··ç”¨ï¼Œå¾ˆé‡è¦çš„ä¸€ä¸ªåŸå› æ˜¯ä¹‹å‰ç‰ˆæœ¬ä¸­äº‹ä»¶å§”æ‰˜æ˜¯æŒ‚åœ¨documentä¸Šçš„ï¼Œ
v17 å¼€å§‹ï¼Œäº‹ä»¶å§”æ‰˜æŒ‚è½½åˆ°äº†æ¸²æŸ“ React æ ‘çš„æ ¹ DOM å®¹å™¨ä¸­ï¼Œè¿™ä½¿å¤š React ç‰ˆæœ¬å¹¶å­˜æˆä¸ºäº†å¯èƒ½ã€‚ï¼ˆæ„å‘³ç€React 17+å¯æ··ç”¨ï¼Œè€é¡µé¢ç»´æŒ v17ï¼Œæ–°é¡µé¢ä½¿ç”¨v18 v19 ç­‰ï¼‰
![image.png](https://cdn.nlark.com/yuque/0/2021/png/674941/1639560993281-ca70439c-2d2c-4a06-b806-72b937a82711.png#averageHue=%23cfebf5&clientId=u52f8c7e2-4b59-4&from=paste&height=325&id=u5420b983&originHeight=650&originWidth=840&originalType=binary&ratio=1&rotation=0&showTitle=false&size=255409&status=done&style=none&taskId=ue69197a6-423c-46e2-8924-ec1dbcedc59&title=&width=420)

- å¼•å…¥æ–°æ¦‚å¿µï¼š**fiberæ ‘
åœ¨React17ä¸­å°†è™šæ‹ŸDOMæ ‘æ”¹ç§°ä¸ºfiberæ ‘**
- åˆæˆäº‹ä»¶ä¼˜åŒ–-æ›´æ”¹æŒ‚è½½çš„æ ¹èŠ‚ç‚¹
- ç§»é™¤äº‹ä»¶æ± 


## React 18ï¼ˆTODOï¼‰
> å‚è€ƒï¼š[React18 æœ‰å“ªäº›å˜åŒ–ï¼Ÿ-Alibaba F2E](https://mp.weixin.qq.com/s/tv_saHFtuxafzDJh25u3lg)

- Reactåˆå¹¶æ›´æ–°è§„åˆ™ ç‚¹å‡»äº‹ä»¶ä¼šè‡ªåŠ¨batchingï¼Œ å¼‚æ­¥å›è°ƒçš„ä¸ä¼š -- **è‡ªåŠ¨Batching**



# äº‹ä»¶å¤„ç†

Reactå…ƒç´ çš„äº‹ä»¶å¤„ç†å’ŒDOMå…ƒç´ çš„å¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯æœ‰ä¸€ç‚¹è¯­æ³•ä¸Šçš„ä¸åŒï¼š

-  Reactäº‹ä»¶çš„å‘½åé‡‡ç”¨å°é©¼å³°å¼(camelCase)ï¼Œä¸ºä¸æ˜¯çº¯å°å†™ã€‚ 
-  ä½¿ç”¨JSXè¯­æ³•æ—¶ä½ éœ€è¦ä¼ å…¥ä¸€ä¸ªå‡½æ•°ä½œä¸ºäº‹ä»¶å¤„ç†å‡½æ•°ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸² 
-  ä¸èƒ½é€šè¿‡è¿”å›`false`çš„æ–¹å¼é˜»æ­¢é»˜è®¤è¡Œä¸ºã€‚
ä½ å¿…é¡»æ˜¾å¼çš„ä½¿ç”¨`preventDefault`ã€‚
ä¾‹å¦‚é˜»æ­¢é“¾æ¥é»˜è®¤æ‰“å¼€ä¸€ä¸ªæ–°é¡µé¢ï¼Œ  
```jsx
 // HTML
 <a href="#" onclick="console.log('The link was clicked'); return false;">
   Click me
 </a>
 
 // React
 function ActionLink(){
   function handleClick(e){
     e.preventDefault();
     console.log('The link was clicked')
   }
 }
```

# äº‹ä»¶ä»£ç†ï¼ˆäº‹ä»¶å§”æ‰˜ï¼‰

> Reactäº‹ä»¶æœºåˆ¶æµç¨‹ï¼š `DOM` -> `ReactEventListener` -> `ReactEventEmitter` -> `EventPluginHub` -> `application`[ã€å‚è€ƒã€‘](https://leo123.pub/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%20react%20%E4%BA%8B%E4%BB%B6%E4%BB%A3%E7%90%86)


- `**ReactEventListener**`**åªè´Ÿè´£ä¸€ä»¶äº‹æƒ…â€”â€”å°è£…åŸç”Ÿæµè§ˆå™¨äº‹ä»¶**
DOMå°†æµè§ˆå™¨çš„åŸç”Ÿäº‹ä»¶ä¼ é€’ç»™ReactEventListener
- `**ReactEventEmitter**`**è´Ÿè´£å°è£…å¥½çš„äº‹ä»¶attachåˆ°é¡¶å±‚çš„event listener**
é¡¶å±‚ï¼ˆtop levelï¼‰äº‹ä»¶ç±»å‹å®šä¹‰åœ¨`EventConstants`æ¨¡å—ä¸­ï¼Œ
åˆ°æ­¤ä¸ºæ­¢æ˜¯Reactä¸»çº¿ç¨‹å®Œæˆçš„ï¼Œå…¶ä½™çš„å…·ä½“äº‹ä»¶å¤„ç†ç”±pluginsè´Ÿè´£
- `**EventPluginHub**`**æ˜¯äº‹ä»¶çš„å¤„ç†ä¸­å¿ƒ**
å®ƒè´Ÿè´£æ¥æ”¶æ·»åŠ å¥½top level event listenerçš„äº‹ä»¶ï¼Œè¯¢é—®å„ä¸ªpluginæ˜¯å¦éœ€è¦è¯¥äº‹ä»¶ï¼Œ
å°†æ¯ä¸ªäº‹ä»¶annotateåˆ°dispatchesï¼Œç„¶ådispatchäº‹ä»¶ã€‚

**reactçš„äº‹ä»¶ä»£ç†æœºåˆ¶ï¼Œå®ƒå¹¶ä¸æ˜¯æŠŠäº‹ä»¶å‡½æ•°ç›´æ¥ç»‘å®šåˆ°çœŸå®çš„èŠ‚ç‚¹ä¸Šï¼Œ**
**è€Œæ˜¯æŠŠæ‰€æœ‰äº‹ä»¶ç»‘å®šåˆ°ç»“æ„çš„æœ€å¤–å±‚ï¼Œä½¿ç”¨ä¸€ä¸ªç»Ÿä¸€çš„äº‹ä»¶ç›‘å¬å™¨ã€‚**

è¿™ä¸ªäº‹ä»¶ç›‘å¬å™¨ç»´æŒäº†ä¸€ä¸ªæ˜ å°„æ¥ä¿å­˜ç»„ä»¶å†…éƒ¨çš„äº‹ä»¶ç›‘å¬ä¸å¤„ç†å‡½æ•°

å½“ç»„ä»¶æŒ‚è½½æˆ–å¸è½½æ—¶ï¼Œåœ¨è¿™ä¸ªç»Ÿä¸€çš„äº‹ä»¶ç›‘å¬å™¨ä¸Šè¿›è¡Œåˆ é™¤å’Œæ’å…¥ä¸€äº›å¯¹è±¡ï¼›
å½“äº‹ä»¶å‘ç”Ÿçš„æ—¶å€™ï¼Œé¦–å…ˆè¢«ç›‘å¬å™¨æ‹¦æˆªï¼Œç„¶ååœ¨æ˜ å°„è¡¨ä¸­æ‰¾åˆ°çœŸæ­£çš„å¤„ç†å‡½æ•°å¹¶è°ƒç”¨ï¼Œ

è¿™æ ·ç®€åŒ–äº†äº‹ä»¶å¤„ç†å’Œå›æ”¶æœºåˆ¶ï¼Œæ•ˆç‡ä¸Šæœ‰å¾ˆå¤§çš„æå‡ï¼Œä¹ŸèŠ‚çœäº†å†…å­˜ï¼ŒæŠ¹å¹³äº†æµè§ˆå™¨å·®å¼‚

# åˆæˆäº‹ä»¶ï¼ˆv16 -> v17ï¼‰

## ç”±åˆæˆäº‹ä»¶å¼•å‘çš„"bug"(v16)

```jsx
  class extends React.Component {
    componentDidMount(){
      document.addEventListener("click",this.handleDocumentClick)
    }
    
    handleDocumentClick=()=>{
      console.log(1) //å³ä½¿è¢«é˜»æ­¢â€œå†’æ³¡â€äº†ï¼Œè¿™é‡Œä¾ç„¶ä¼šè¢«æ‰§è¡Œ
    }
    
    handleButtonClick=(e)=>{
      e.nativEvent.stopPropagation();
      console.log(2)
    }
    
    render(){
      return (
        <Button title="click" onClick={this.handleButtonClick}/>
      )
    }
  }
```

ä¸Šé¢çš„`e.preventDefault()`çš„`e`æ˜¯ä¸€ä¸ª**åˆæˆäº‹ä»¶**ã€‚

1. Reactæ ¹æ®W3Cè§„èŒƒæ¥**è‡ªè¡Œå®ç°**äº†ä¸€å¥—äº‹ä»¶æ•è·åˆ°äº‹ä»¶å†’æ³¡çš„é€»è¾‘ï¼ŒæŠ¹å¹³äº†å„ä¸ªæµè§ˆå™¨ä¹‹å‰çš„å…¼å®¹æ€§é—®é¢˜
2. ä½¿ç”¨**å¯¹è±¡æ± **æ¥ç®¡ç†åˆæˆäº‹ä»¶å¯¹è±¡çš„åˆ›å»ºå’Œé”€æ¯ï¼Œå¯ä»¥å‡å°‘åƒåœ¾å›æ”¶æ¬¡æ•°ï¼Œé˜²æ­¢å†…å­˜æŠ–åŠ¨(å¯¹äº‹ä»¶çš„å®šåˆ¶åŒ–éœ€æ±‚)
3. äº‹ä»¶åªåœ¨`document`ä¸Šç»‘å®šï¼Œå¹¶ä¸”**æ¯ç§äº‹ä»¶åªç»‘å®šä¸€æ¬¡**ï¼Œå‡å°‘å†…å­˜å¼€é”€

ä½¿ç”¨Reactæ—¶ï¼Œä¸€èˆ¬ä¸éœ€è¦ä½¿ç”¨`addEventListener`ä¸ºä»¥åˆ›å»ºçš„DOMå…ƒç´ æ·»åŠ ç›‘å¬å™¨ã€‚
äº‹å®ä¸Šï¼Œåªéœ€è¦åœ¨è¯¥å…ƒç´ åˆå§‹æ¸²æŸ“çš„æ—¶å€™æ·»åŠ ç›‘å¬å™¨å³å¯ã€‚

> Q: å¦‚ä½•è§£å†³ä¸Šè¿°â€œbugâ€


1.  ä»`document.addEventListener`æ”¹æˆ`window.addEventListener`ã€‚
å†’æ³¡é¡ºåºï¼šdocument > windowã€‚é˜»æ­¢çš„æ˜¯document 
2.  ä»`e.stopPropagation()`æ”¹æˆ`e.stopImplementPagatoion()`
æŠŠå½“å‰äº‹ä»¶æ‰§è¡Œååºå…¨éƒ¨é˜»æ­¢æ‰ 
3.  React17ä¿®å¤äº†è¿™ä¸ªbugï¼Œ
å› ä¸ºä¸å†ç»‘å®šåˆ°`document`ä¸Šäº†ï¼Œè€Œæ˜¯ç»‘å®šåˆ°`render`å‡½æ•°çš„èŠ‚ç‚¹ä¸Šï¼ˆè¯¦è§äº‹ä»¶ä»£ç†ï¼ˆäº‹ä»¶å§”æ‰˜ï¼‰ï¼‰ 

## åˆæˆäº‹ä»¶ä¼˜åŠ¿

> Q: ä¸ºä»€ä¹ˆè¦è‡ªè¡Œæ¨¡æ‹Ÿäº‹ä»¶ï¼Œè€Œä¸ç”¨åŸç”Ÿçš„äº‹ä»¶æ¥è¿›è¡Œç»‘å®šæ“ä½œå‘¢ï¼Ÿ
A: åˆæˆäº‹ä»¶å¯ä»¥åšåˆ°æ‰¹é‡æ›´æ–°ã€‚
Q: åŸç”Ÿäº‹ä»¶å¦‚ä½•ä¹Ÿåšåˆ°æ‰¹é‡æ›´æ–°å‘¢ï¼Ÿ
A: é€šè¿‡`batchUpdate`å‡½æ•°æ‰‹åŠ¨å£°æ˜è¿è¡Œä¸Šä¸‹æ–‡


```jsx
    this.button.current.addEventListener(
      "click",
      this.handleClick,
      false
    );
    
    handleClick=()=>{
      this.setState((preState) => ({ count: preState.count + 1 }));
      this.setState((preState) => ({ count: preState.count + 1 }));
    }
    
<button ref="btn1"/> // è¿™ä¸ªç‚¹å‡»ä¼šrender2æ¬¡
<button onClick={this.handleClick} /> //è¿™ä¸ªç‚¹å‡»åªä¼šrender1æ¬¡
```

```jsx
  import ReactDOM from "React-dom";
  
  handleNativeClickButton = () => {
    ReactDOM.unstable_batchedUpdates(() => {
      this.setState((preState) => ({ count: preState.count + 1 }));
      this.setState((preState) => ({ count: preState.count + 1 }));
    });
  };
  
  // ä¸æƒ³ä¿®æ”¹åŸä»£ç ï¼Œå¯ä»¥ç”¨`concurrent mode`(ä¸æ¨èï¼Œæœªæ¥çš„æ–¹æ¡ˆ)
  import ReactDOM from "React-dom";

  const root = ReactDOM.unstable_createRoot(document.getElementById("root"));
  root.render(<App />);
```

**React17æ–°æ¦‚å¿µï¼šfiberæ ‘**

åœ¨React17ä¸­å°†è™šæ‹ŸDOMæ ‘æ”¹ç§°ä¸º`fiberæ ‘`

**äº‹ä»¶å†’æ³¡çš„è¿‡ç¨‹**

```bash
 DOMæ ‘    fiberæ ‘

 html    FiberRootNode
  |         |
 body    rootFiber
  |         |
 div      App fiber
  |         |
  p       div fiber
            |
           p fiber
```

**åˆæˆäº‹ä»¶åœ¨React17ä¸­çš„å®ç°**

1. åœ¨`document`ç»‘å®š`event handler`,é€šè¿‡äº‹ä»¶å§”æ‰˜çš„æ–¹å¼ç›‘å¬äº‹ä»¶
2. å½“äº‹ä»¶è§¦å‘åï¼Œé€šè¿‡`e.target`è·å–è§¦å‘äº‹ä»¶çš„`DOM`ï¼Œæ‰¾åˆ°`DOM`å¯¹åº”çš„`fiber`
3. ä»`**è¯¥fiber**`å‘`**æ ¹fiber**`éå†ï¼Œæ”¶é›†éå†è¿‡ç¨‹ä¸­æ‰€æœ‰ç»‘å®šäº†`**è¯¥ç±»å‹äº‹ä»¶çš„fiber**`çš„`event handler`ï¼Œä¿å­˜åœ¨æ•°ç»„`paths`ä¸­
4. éå†pathsï¼Œä¾æ¬¡è°ƒç”¨event handlerï¼Œæ¨¡æ‹Ÿ`æ•è·æµç¨‹`
5. éå†path.reverse(),ä¾æ¬¡è°ƒç”¨event handler,æ¨¡æ‹Ÿ`å†’æ³¡æµç¨‹`

**ç»„ä»¶å¯¹åº”DOMå“åº”ç‚¹å‡»äº‹ä»¶**

å‘ç»„ä»¶ä¼ é€’`onClick props`æ—¶ï¼Œç»„ä»¶æœ¬èº«å¹¶ä¸ä¼šç»‘å®šå¯¹åº”çš„`handler`ï¼Œç»„ä»¶é”€æ¯åä¹Ÿä¸ä¼šæœ‰`click handler`çš„è§£ç»‘æ“ä½œ
è¯¥DOMå¯¹åº”çš„fiberä¸Šçš„`onClick`å›è°ƒåœ¨`dispatchEvent`æ–¹æ³•ä¸­çš„`collectPaths`ä¸­è¢«æ”¶é›†ï¼Œå¹¶åœ¨`tiggerEventFlow`ä¸­è¢«è°ƒç”¨

## SyntheticEvent

`SyntheticEvent`ï¼ˆSynthetic åˆæˆï¼‰å®ä¾‹å°†è¢«ä¼ é€’ç»™ä½ çš„äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œ
**å®ƒæ˜¯æµè§ˆå™¨çš„åŸç”Ÿäº‹ä»¶çš„è·¨æµè§ˆå™¨åŒ…è£…å™¨**ã€‚é™¤å…¼å®¹æ‰€æœ‰æµè§ˆå™¨å¤–ï¼Œå®ƒè¿˜æ‹¥æœ‰å’Œæµè§ˆå™¨åŸç”Ÿäº‹ä»¶ç›¸åŒçš„æ¥å£ï¼Œ
åŒ…æ‹¬`stopPropagation()`å’Œ`preventDefault()`ã€‚

å¦‚æœå› ä¸ºæŸäº›åŸå› ï¼Œå½“ä½ éœ€è¦ä½¿ç”¨æµè§ˆå™¨çš„åº•å±‚äº‹ä»¶æ—¶ï¼Œåªéœ€è¦ä½¿ç”¨`nativeEvent`å±æ€§æ¥è·å–å³å¯ã€‚
æ¯ä¸ª`SyntheticEvent`å¯¹è±¡éƒ½åŒ…å«ä»¥ä¸‹å±æ€§ï¼š

```java
    boolean bubbles
    boolean cancelable
    DOMEventTarget currentTarget
    boolean defaultPrevented
    number eventPhase // è¡¨ç¤ºäº‹ä»¶æµæ­£è¢«å¤„ç†åˆ°æ¥å“ªä¸ªé˜¶æ®µ
    boolean isTrusted // è¡¨ç¤ºäº‹ä»¶ç”±æµè§ˆå™¨ï¼ˆä¾‹å¦‚ç”¨æˆ·ç‚¹å‡»ï¼‰å‘èµ·çš„ï¼Œè¿˜æ˜¯ç”±è„šæœ¬ï¼ˆä½¿ç”¨äº‹ä»¶åˆ›å»ºæ–¹æ³•ï¼Œä¾‹å¦‚Event.initEventï¼‰å‘å‡ºçš„
    DOMEvent nativeEvent
    void preventDefault()
    boolean isDefaultPrevented()
    void stopPropagation()
    boolean isPropagationStopped()
    void persist() // äº‹ä»¶æ± ä¸­å…è®¸ç”¨æˆ·ä»£ç ä¿ç•™å¯¹äº‹ä»¶çš„å¼•ç”¨
    DOMEventTarget target
    number timeStamp
    string type
```

> âš ï¸æ³¨æ„ï¼š
æˆªæ­¢v0.14ï¼Œå½“äº‹ä»¶å¤„ç†å‡½æ•°è¿”å›`false`æ—¶ï¼Œä¸å†é˜»æ­¢äº‹ä»¶å†’æ³¡ã€‚ä½ å¯ä»¥é€‰æ‹©ä½¿ç”¨`e.stopPropagation()`æˆ–è€…`e.preventDefault()`ä»£æ›¿
åœ¨React17ä¸­ï¼Œ
>  
> 1. `onScroll`äº‹ä»¶ä¸å†å†’æ³¡ï¼Œä»¥é˜²æ­¢å‡ºç°å¸¸è§çš„æ··æ·†ï¼›
> 2. `onFocus`å’Œ`onBlur`äº‹ä»¶åº•å±‚åˆ‡æ¢ä¸ºåŸç”Ÿçš„`focusin`å’Œ`focusout`
> 3. æ•è·äº‹ä»¶ï¼ˆä¾‹å¦‚`onClickCapture`ï¼‰ç°åœ¨ä½¿ç”¨çš„æ˜¯å®é™…æµè§ˆå™¨ä¸­çš„æ•è·ç›‘å¬å™¨
> 



## äº‹ä»¶æ± (v16)

`SyntheticEvent`æ˜¯åˆå¹¶è€Œæ¥ã€‚è¿™æ„å‘³ç€`SyntheticEvent`å¯¹è±¡å¯èƒ½ä¼šè¢«é‡ç”¨ï¼Œè€Œä¸”åœ¨äº‹ä»¶å›è°ƒå‡½æ•°è¢«è°ƒç”¨åï¼Œ
æ‰€æœ‰çš„å±æ€§éƒ½ä¼šæ— æ•ˆã€‚**å‡ºäºæ€§èƒ½è€ƒè™‘ï¼Œä½ ä¸èƒ½é€šè¿‡å¼‚æ­¥è®¿é—®äº‹ä»¶**

> ä½¿ç”¨`äº‹ä»¶æ± `æ¥ç®¡ç†åˆæˆäº‹ä»¶å¯¹è±¡çš„åˆ›å»ºå’Œé”€æ¯ï¼Œå¯ä»¥å‡å°‘åƒåœ¾å›æ”¶æ¬¡æ•°ï¼Œé˜²æ­¢å†…å­˜æŠ–åŠ¨ã€‚
**åœ¨React17ä¸­ç§»é™¤äº†**`**event pooling**`


```javascript
  function onClick(event) {
    console.log(event); // => nullified object.
    console.log(event.type); // => "click"
    const eventType = event.type;
    
    setTimeout(function(){
      console.log(event.type); // => null
      console.log(eventType); // => "click"
    });
    
    // ä¸èµ·ä½œç”¨ï¼Œthis.state.clickEvent çš„å€¼å°†ä¼šåªåŒ…å«null
    this.setState({clickEvent: event});
    
    // ä½ ä»ç„¶å¯ä»¥å¯¼å‡ºäº‹ä»¶å±æ€§
    this.setState({eventType: event.type});
  }
```

> âš ï¸æ³¨æ„ï¼š
å¦‚æœä½ æƒ³å¼‚æ­¥è®¿é—®äº‹ä»¶å±æ€§ï¼Œä½ éœ€åœ¨äº‹ä»¶ä¸Šè°ƒç”¨`event.persist()`ï¼Œ
æ­¤æ–¹æ³•ä¼šæ± ä¸­ç§»é™¤åˆæˆäº‹ä»¶ï¼Œå…è®¸ç”¨æˆ·ä»£ç ä¿ç•™å¯¹äº‹ä»¶çš„å¼•ç”¨ã€‚


**SyntheticEventé‡ç”¨çš„å…¶ä»–æ–¹æ¡ˆ**
> å‚è€ƒï¼š[https://medium.com/trabe/react-syntheticevent-reuse-889cd52981b6](https://medium.com/trabe/react-syntheticevent-reuse-889cd52981b6)


ç¼“å­˜æ‰€éœ€çš„å±æ€§

```jsx
   constructor(props){
     super(props);
     this.debounceChange=debounce(this.onChange,400);
   }

   onChange=(e)=>{
        console.log(e?.target?.value)
    };

    render(){
        return (
            <Fragment>
                <input type="text" onChange={this.onChange}/>

                {/** doest work and need to add `event.persist()` **/}
                <input type="text" onChange={this.debounceChange}/>

                {/** ç¼“å­˜æ‰€éœ€çš„å±æ€§ **/}
                <input type="text" onChange={({target:{ value }})=>this.debounceChange({target:{ value }})}/>
            </Fragment>
        )
    }
```

## æ”¯æŒçš„äº‹ä»¶

Reacté€šè¿‡å°†äº‹ä»¶normalizeä»¥è®©ä»–ä»¬åœ¨ä¸åŒæµè§ˆå™¨ä¸­æ‹¥æœ‰ä¸€è‡´çš„å±æ€§ã€‚

ç›®å‰é»˜è®¤æ”¯æŒ **å†’æ³¡é˜¶æ®µè¢«è§¦å‘**çš„äº‹ä»¶ï¼Œå¦‚æœéœ€è¦æ³¨å†Œæ•è·é˜¶æ®µçš„äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œåˆ™å‘½åè§„åˆ™ä¸º
äº‹ä»¶ååŠ `Capture`ï¼Œä¾‹å¦‚å¤„ç†æ•è·é˜¶æ®µçš„ç‚¹å‡»äº‹ä»¶è¯·ä½¿ç”¨`onClickCapture`ï¼Œ`onClick`æ˜¯å†’æ³¡é˜¶æ®µè¢«è§¦å‘çš„äº‹ä»¶

# keyï¼ˆTODOï¼‰

Qï¼škeyåœ¨diffä¸­çš„ä½œç”¨

> åœ¨æ¸²æŸ“åˆ—è¡¨èŠ‚ç‚¹ä¸­ï¼Œ**é€šè¿‡keyå¯ä»¥åœ¨åç»­diffæ—¶ç§»åŠ¨èŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯æ›´æ–°èŠ‚ç‚¹**,å°½å¯èƒ½åœ°å¤ç”¨ä¹‹å‰çš„DOMèŠ‚ç‚¹ã€‚
åœ¨æ•°æ®å˜åŒ–æ—¶å¼ºåˆ¶æ›´æ–°ç»„ä»¶ï¼Œé¿å…åŸåœ°å¤ç”¨å…ƒç´ èŠ‚ç‚¹å¸¦æ¥çš„å‰¯ä½œç”¨ã€‚


> ä½¿ç”¨keyå¹¶ä¸ä¸€å®šèƒ½å¸¦æ¥æ€§èƒ½ä¸Šçš„æå‡ï¼Œè€Œæ˜¯ä¸ºäº†é¿å…åŸåœ°å¤ç”¨å…ƒç´ èŠ‚ç‚¹å¸¦æ¥çš„å½±å“


é¦–å…ˆï¼Œdiffç®—æ³•ä¸­çš„handlerså¤„ç†æ–¹å¼æœ‰

- `remove`
- `replace`
- `update`
- `insert`

æ‰€ä»¥æœ‰æ— keyæ—¶å¯¹èŠ‚ç‚¹çš„å¤„ç†æ˜¯ä¸åŒçš„

| `[1,2,3]` | æ— key | æœ‰key |
| --- | --- | --- |
| `[2,1,3]` | 1 update 2, 2 update 1ï¼Œæ›´æ–°äº†ä¸¤ä¸ªèŠ‚ç‚¹ | 1 replace 2ï¼Œ2 replace 1,æ›´æ–°äº†ä¸¤ä¸ªèŠ‚ç‚¹ |
| `[1,3]` | 2 update 3 , remove 3,æ›´æ–°äº†ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåˆ é™¤äº†ä¸€ä¸ªèŠ‚ç‚¹ | remove 2ï¼Œåªåˆ é™¤äº†ä¸€ä¸ªèŠ‚ç‚¹ |
| `[1, 4, 2, 3]` | 2 update 4, 3 update 2, insert 3 | insert 4 |


åŸºäºkeyå¯ä»¥å¢åŠ ä¸€ç§`MOVE`çš„å¤„ç†æ–¹å¼

- `move`
`[1,2,3] to [2,1,3]`åªéœ€è¦ä¸€ä¸ªæ“ä½œ 1 move 2

keyå¸®åŠ©Reactè¯†åˆ«å“ªäº›å…ƒç´ æ”¹å˜äº†ï¼Œæ¯”å¦‚è¢«æ·»åŠ æˆ–åˆ é™¤ã€‚
å› æ­¤ä½ åº”å½“ç»™æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ èµ‹äºˆä¸€ä¸ªç¡®å®šçš„æ ‡è¯†ã€‚

-  [**æ·±åº¦è§£æä½¿ç”¨ç´¢å¼•ä½œä¸ºkeyçš„è´Ÿé¢å½±å“**](https://jsbin.com/wohima/edit?js,output)
**é€šå¸¸ä½¿ç”¨æ•°æ®ä¸­çš„idæ¥ä½œä¸ºå…ƒç´ çš„key**
å¦‚æœåˆ—è¡¨é¡¹ç›®çš„é¡ºåºå¯èƒ½ä¼šå˜åŒ–ï¼Œæˆ‘ä»¬ä¸å»ºè®®ä½¿ç”¨ç´¢å¼•æ¥ç”¨ä½œkeyå€¼ 
   - ä¾‹å¦‚ï¼š
åˆ é™¤æˆ–å¢åŠ åˆ°æŒ‡å®šä½ç½®ï¼Œå…¶ä»–ç»„ä»¶ä¸å˜
**keyä¸ºç´¢å¼•æ—¶æˆ–è€…ä¸è®¾ç½®æ—¶ï¼Œå½“æ–°å¢æˆ–åˆ é™¤æ—¶ï¼Œç´¢å¼•ä¼šå˜æˆ–æ‰€åœ¨ä½ç½®å˜æ¥ï¼Œæ‰€ä»¥æ‰€æœ‰ç»„ä»¶å…¨éƒ½ä¼šåˆ·æ–°**
**å¹¶ä¸”ç‰¹åˆ«åƒinputå†…æœ‰ä¸´æ—¶å€¼ä¸ä¼šâ€œç§»åŠ¨â€**
-  [**æ·±å…¥è§£æä¸ºä»€ä¹ˆkeyæ˜¯å¿…é¡»çš„**](https://zh-hans.reactjs.org/docs/reconciliation.html#recursing-on-children) 
   - å¦‚æœä½¿ç”¨ç´¢å¼•indexæ¥ä½œä¸ºkeyæ—¶ï¼Œä¿®æ”¹é¡ºåºä¼šä½¿å¾—diffå¾ˆæ…¢
   - æ’å…¥å’Œåˆ é™¤æ“ä½œå°†ä¼šé‡å»ºæ•´ä¸ªåˆ—è¡¨ï¼Œè€Œéæ’å…¥å’Œåˆ é™¤æŸä¸€ä¸ª
-  **keyä¼šä¼ é€’ä¿¡æ¯ç»™Reactï¼Œä½†ä¸ä¼šä¼ é€’ç»™ä½ çš„ç»„ä»¶** 
-  **keyå€¼å‘ç”Ÿæ”¹å˜æ—¶ï¼ŒReactä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç»„ä»¶å®ä¾‹è€Œä¸æ˜¯æ›´æ–°å½“å‰ç»„ä»¶** 
-  keyåº”è¯¥æ˜¯**å”¯ä¸€çš„**ï¼Œ**ç¨³å®šçš„**å’Œ**å¯é‡ç°çš„** 
-  **å”¯ä¸€**ï¼š
å…ƒç´ çš„keyåœ¨**åŒçº§å…ƒç´ **ä¸­åº”è¯¥æ˜¯å”¯ä¸€çš„ï¼Œï¼ˆåœ¨å…¨å±€ä¸­ä¸å¿…å”¯ä¸€ï¼‰ï¼Œä»¥ä¾¿ç»„ä»¶åœ¨æ›´æ–°æœŸé—´ä¿æŒå…¶èº«ä»½ã€‚
éå”¯ä¸€keyå¯èƒ½ä¼šå¯¼è‡´å­ä»£é‡å¤/æˆ–è¢«å¿½ç•¥ 
-  **ç¨³å®š**ï¼š
ä¸èƒ½ç”¨ç´¢å¼•ä¹‹ç±»çš„å€¼ä½œä¸ºkey 
-  **å¯é‡ç°**ï¼š
ä¸èƒ½ç”¨`Math.random`ã€`new Date()`ä¹‹ç±»çš„å€¼ä½œä¸ºkey 



# ReactDOM



è·å–refå¯¹åº”çš„Docuemnt DOM

```jsx
import {findDOMNode} from 'react-dom'

findDOMNode(refs)
```

