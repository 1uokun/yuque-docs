# 接口

1.  领域接口（原子接口）
即按领域、业务模块划分，需要前端多次访问，聚合逻辑 
2.  聚合接口（外观接口）
即后端根据页面把这些模块按一定逻辑聚合到一起，前端少量几次请求即可 
3.  问题：聚合逻辑应该谁来做？ 

根据业务场景划分（永远离不开业务场景），如果全都后端来做聚合，有些原子接口不能并行，必须有一定顺序请求，那么聚合过程会很慢

3.1. 根据 页面渲染优先级 给定领域接口
3.2. 根据接口是 否可缓存 来分析
3.3. 可缓存接口中再根据 可定时缓存、 访问换成 分析

4.  BFF架构（Backends For Frontends）
添加【API层】也叫【胶水层】专门做聚合 
5.  总结：合理的拆分和搭配，一切以业务优先 

## RESTful

Representational state transfer

是一种约定，参考google的[API设计指南](https://cloud.google.com/apis/design)

## 后台微服务 microservice

【胶水层】的一种实现，微服务通过API Gateway提供RESTful接口
优点是：

1. 具有业务的独立性和完整性，减少服务间的依赖
2. 微服务可以独立部署，便于负载管理和优化

## GraphQL

聚合可以用GraphQL来实现更轻松一些

GraphQL是一种针对Graph（图状数据）进行查询特别有优势的Query Language(查询语言)，所以叫做GraphQL。
它跟SQL的关系是共用QL后缀，就好像「汉语」和「英语」共用后缀一样，但他们本质上是不同的语言。

一个超级复杂的树状结构 可能需要多个类型的领域接口去获取，而且这些请求中还存在依赖关系，不能平行地发多个请求

为了解决这个问题，一个简单粗暴的办法是专门写一个RESTful API来聚合上述过程。但是很快新问题就会出现，随着业务迭代后面又要加一个类型的领域接口数据，那么RESTful API的实现也要跟着改。

GraphQL 能够很好地解决这个问题，但前提是数据已经以图的数据结构进行保存。

相关元素：
顶点类型、边类型

作者：Cat Chen 链接：[https://www.zhihu.com/question/264629587/answer/949588861](https://www.zhihu.com/question/264629587/answer/949588861) 

# Node.js应用场景

> 概念

1. **直出
**在前后端接口分离（前后端解偶）情况下，客户端访问页面时，从服务器拉去接口数据，并将数据嵌入页面，称为直出；
如果返回的是数据和模版，在前端渲染，称为【数据直出】；
如果后端根据数据渲染出页面，直接返回页面，【页面直出】
2. **前后端分离
**在服务器（JAVA/PHP）与浏览器（JS）的中间架一个Node的中间层
Node中间层提供直出，接口转发，静态资源等，属于前端范畴，由前端维护

特点：
1. MVC模型中，由前端接管VC，后端专注M
2. 解决性能问题：前端可以根据业务场景使用服务端直出和接口聚合等技术，减少客户端白屏时间
3. 将前端公用业务和逻辑后移，减少多端的重复开发

> 实战案例

1. [**百度地图瓦片直出**](https://www.cnblogs.com/well1010/articles/baidu-map-node-canvas.html)** **
有些端是渲染canvas的，有些端是渲染图片的
这时就可以用node来实现跨段抹平——将canvas数据渲染成图片直出


# 业务场景
## Webview鉴权流程(一次性短链)

1. 平台：访问链接通过【构造接口】+登陆态 构造一个一次性链接（或短链）
2. 一次性链接：是指定到h5一个专门处理短链的页面（也可以是后端301来做）
3. 处理链接页面：再通过【还原接口】转换成真实链接+登陆态，并重定向

