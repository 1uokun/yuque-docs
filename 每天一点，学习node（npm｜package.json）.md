## ä»£ç†åŠ é€Ÿ

> ç½‘ç»œä»£ç†ï¼šhttps://www.jianshu.com/p/709c6853cc42
> npmæ¢æºï¼šhttps://juejin.cn/post/7054747440032776199

```bash
# æ·˜å®é•œåƒ
npm config set registry https://registry.npmmirror.com
# åŸå§‹åœ°å€
npm config set registry https://www.npmjs.com/


# è®¾ç½®ä»£ç†
npm config set proxy=http://127.0.0.1:7890
#åˆ é™¤ä»£ç†
npm config delete proxy
```



# é‡å‘½ånpmåŒ…

```json
"dependencies": {
  "@ant-design/react-native": "npm:@react-sextant/react-native-test@5.2.4",
}
```



# ä¾èµ–ç®¡ç†

> å‚è€ƒé“¾æ¥ï¼š[https://mp.weixin.qq.com/s/9JCs3rCmVuGT3FvKxXMJwg](https://mp.weixin.qq.com/s/9JCs3rCmVuGT3FvKxXMJwg)

- npm v2/v3
- yarn
- pnpm

## npm2
**npm2å®‰è£…ä¾èµ–æ­¥éª¤ï¼š**

1. å‘å¸ƒnpm installå‘½ä»¤
2. npmå‘registryæŸ¥è¯¢æ¨¡å—å‹ç¼©åŒ…çš„ç½‘å€
3. ä¸‹è½½å‹ç¼©åŒ…ï¼Œå­˜æ”¾åœ¨`~/.npm`ç›®å½•
4. å°†å‹ç¼©åŒ…è§£å‹åˆ°å½“å‰é¡¹ç›®çš„node_modulesç›®å½•

npm2å­˜åœ¨é—®é¢˜ï¼š

1. **åµŒå¥—åœ°ç‹±
**åˆæœŸnpmå¯¹ä¾èµ–æ ‘ä¸åšä»»ä½•å»é‡åˆå¹¶ï¼Œå¯¼è‡´ç›¸åŒä¾èµ–é‡å¤å®‰è£…
```javascript
node_modules
â”œâ”€â”€ A@1.0.0
â”‚   â””â”€â”€ node_modules
â”‚       â””â”€â”€ B@1.0.0
â””â”€â”€ C@1.0.0
    â””â”€â”€ node_modules
        â””â”€â”€ B@1.0.0
        â””â”€â”€ D@1.0.0
```
![image.png](https://cdn.nlark.com/yuque/0/2023/png/674941/1683790279763-e2e3b369-e067-477b-8b30-e71e79ff192c.png#averageHue=%23f9f8f7&clientId=u856b947f-c016-4&from=paste&height=246&id=svSgM&originHeight=500&originWidth=1000&originalType=binary&ratio=1&rotation=0&showTitle=false&size=128545&status=done&style=none&taskId=u3445d378-2e3e-4420-b358-3b47f97de02&title=&width=491)
## npm3
**npm3å®‰è£…ä¾èµ–æ­¥éª¤ï¼š**

1. **æ£€æŸ¥é…ç½®ï¼šè¯»å–**`**npm config**`**å’Œ**`**.npmrc**`**é…ç½®**
æ¯”å¦‚é…ç½®é•œåƒæº`registry = 'https://bnpm.byted.org/'`

2. **ç¡®å®šä¾èµ–ç‰ˆæœ¬ã€æ„å»ºä¾èµ–æ ‘**ï¼šæ£€æŸ¥`package-lock.json`
è‹¥å­˜åœ¨ï¼Œæ ¹æ®`lockfileVersion`å­—æ®µå€¼ç¡®å®š`~`ã€`>`ã€`^`å‰ç¼€ç‰ˆæœ¬æ˜¯å¦éœ€è¦æ›´æ–°
è‹¥ä¸å­˜åœ¨ï¼Œæ ¹æ®`packge.json`ç‰ˆæœ¬å’Œå½“å‰`npm`ç‰ˆæœ¬é‡æ–°å®‰è£…node_moduleså’Œç”Ÿæˆlockæ–‡ä»¶

3. **å¹¶è¡Œå®‰è£…ï¼š**npm2è¿˜æ˜¯æŒ‰é¡ºåºé€ä¸ªå®‰è£…çš„

4. **æ£€æŸ¥ç¼“å­˜æˆ–ä¸‹è½½**ï¼šæ ¹ç›®å½•node_modulesåŒ…ä¸­æŸ¥çœ‹æœ‰æ²¡æœ‰ç¼“å­˜ï¼Œæ²¡æœ‰å°±ä¸‹è½½ã€‚
æ›´æ–°`package-lock.json`

npm3å­˜åœ¨çš„é—®é¢˜ï¼š

1. **æ‰å¹³åŒ–åµŒå¥—
**é’ˆå¯¹npm2çš„åµŒå¥—åœ°ç‹±ï¼Œnpm3å°†å­ä¾èµ–ã€Œæå‡ã€ï¼ˆ`hoist`ï¼‰ï¼Œ
ç›¸åŒå­ä¾èµ–å°½é‡åˆå¹¶å¹³é“ºå®‰è£…åœ¨ä¾èµ–æ ‘ä¸Šä¸€å±‚ã€‚
```javascript
node_modules
â”œâ”€â”€ A@1.0.0
â”œâ”€â”€ B@1.0.0
â””â”€â”€ C@1.0.0
     â””â”€â”€ node_modules
          â””â”€â”€ B@2.0.0
```
```javascript
node_modules
â”œâ”€â”€ A@1.0.0
â”‚   â””â”€â”€ node_modules
â”‚       â””â”€â”€ B@1.0.0
â”œâ”€â”€ B@2.0.0
â””â”€â”€ C@1.0.0
```

2. **hoistæå‡å“ªä¸ªåŒ…ï¼Ÿæ‰å¹³å…·ä½“ç®—æ³•**
ç½‘ä¸Šè¯´çš„ä¼šæ ¹æ®package.jsoné‡Œé¢çš„é¡ºåºå†³å®šè°ä¼šè¢«æå‡ºæ¥ï¼Œæ”¾åœ¨å‰é¢çš„åŒ…ä¾èµ–å†…å®¹ä¼šè¢«å…ˆæå‡ºæ¥
çœ‹æºç åï¼Œnpmä¼šè°ƒç”¨ä¸€ä¸ªå«åš`localeCompare`å¾…éªŒè¯â“çš„æ–¹æ³•å¯¹ä¾èµ–è¿›è¡Œæ’åº
**å®é™…ä¸Šå°±æ˜¯å­—å…¸åºåœ¨å‰é¢çš„npmåŒ…çš„åº•å±‚ä¾èµ–ä¼šè¢«ä¼˜å…ˆæå‡ºæ¥ï¼Œ**ä¸Šé¢ä¾‹å­ä¼šå…ˆæå‡AåŒ…é‡Œçš„å­ä¾èµ–ã€‚
å…·ä½“è¿‡ç¨‹ï¼šå€ŸåŠ©â€œ**æœ€å¤§å­æ ‘ä¼˜åŒ–**ï¼ˆMaximal Shrinkwrapï¼‰â€ç®—æ³•ï¼Œå°†ä¾èµ–æ ‘ä¼˜åŒ–ä¸º**æœ€å°åŒ–çš„å­æ ‘**ã€‚
ä»è€Œè¾¾åˆ°å°½å¯èƒ½å‡å°‘å†—ä½™å’Œé‡å¤çš„æ¨¡å—å®‰è£…ã€å‡å°é¡¹ç›®æ‰“åŒ…æåŠã€æé«˜æ ¹ç›®å½•node_modulesç¼“å­˜å‘½ä¸­ç‡
****æœ€å¤§å­æ ‘ä¼˜åŒ–+localeCompareè¡ç”Ÿç®—æ³•é¢˜ï¼š**[https://juejin.cn/post/7083423385899761700](https://juejin.cn/post/7083423385899761700)

3. **å¹½çµä¾èµ– ï¼ˆéšå¼ä¾èµ–ï¼‰**
ä¸åœ¨package.jsoné‡Œæ˜¾æ€§ä¾èµ–çš„å­ä¾èµ–åŒ…ï¼Œä½†åœ¨é¡¹ç›®ä»£ç ä¸­å¼•ç”¨äº†è¿™ä¸ªåŒ…ï¼Œä¹Ÿå°±æ˜¯**éæ³•è®¿é—®ã€‚**
ç‰¹åˆ«æ˜¯åœ¨monorepoæ¨¡å¼ï¼Œeslinté™æ€ä»£ç æ£€æµ‹å·¥ä½œä¹Ÿåšä¸äº†ï¼Œç›®å‰åªæœ‰é ç¼–è¾‘å™¨è‡ªå·±å®ç°ï¼ˆIDEAï¼‰

**è§£å†³å¹½çµä¾èµ–é—®é¢˜**ï¼Œ1.å°½é‡ä¸è¦å¼•ç”¨package.jsonä¸­æ²¡æœ‰æ˜¾æ€§å£°æ˜çš„ä¾èµ–
2. ä½¿ç”¨å¹½çµä¾èµ–æ‰«æå·¥å…· [https://www.npmjs.com/package/@sugarat/ghost](https://www.npmjs.com/package/@sugarat/ghost)

4. **ä¾èµ–åˆ†èº«**`doppelganger`
ä¸€ä¸ªåŒ…ååªèƒ½æå‡1æ¬¡ï¼Œåé¢ä¾èµ–ç›¸åŒåŒ…åç›¸åŒç‰ˆæœ¬ï¼Œä¾ç„¶ä¼šé‡å¤å®‰è£…ã€‚
çœ‹èµ·æ¥Cå’ŒEéƒ½å¼•ç”¨äº†B2ï¼Œä½†ä¸æ˜¯åŒä¸€ä¸ªB2ã€‚å¦‚æœB2 moduleå­˜åœ¨ä¸€äº›å‰¯ä½œç”¨æˆ–ç¼“å­˜ï¼Œå¯èƒ½ä¼šå‡ºé”™ã€‚
```javascript
node_modules
â”œâ”€â”€ A@1.0.0
â”œâ”€â”€ B@1.0.0
â”œâ”€â”€ D@1.0.0
â”œâ”€â”€ C@1.0.0
â”‚    â””â”€â”€ node_modules
â”‚         â””â”€â”€ B@2.0.0
â””â”€â”€ E@1.0.0
      â””â”€â”€ node_modules
           â””â”€â”€ B@2.0.0
```
## npm5ã€npm7
npmè·³è¿‡äº†v4/v6ç‰ˆæœ¬ï¼Œç›´æ¥ä»npm v2 -> v3 -> v5 -> v7;

**npm5**å¯¹äºnpm3åšäº†å“ªäº›ä¼˜åŒ–ï¼š

1. æœ¬åœ°node_modulesç¼“å­˜ç›®å½•ç»“æ„å®Œå…¨æ‰å¹³åŒ–
npm3çš„è¿˜æ˜¯åµŒå¥—ç›®å½•ç»“æ„ï¼ˆåŒé¡¹ç›®ï¼‰
ä¸è¿‡npmv5åœ¨package-lock.jsonæ–‡ä»¶é‡Œï¼Œä¾èµ–å…³ç³»æ ‘ä»ç„¶ä¿ç•™

2. **æ”¯æŒäº†package.jsonçš„scriptsè„šæœ¬å‘½ä»¤**

**npm7**å¯¹äºnpm5åšäº†å“ªäº›ä¼˜åŒ–ï¼š

1. **è‡ªåŠ¨å®‰è£…**`**peerDependencies**`**è¿™å°±å¯¹npmåŒ…çš„peerä¾èµ–ç‰ˆæœ¬éœ€è¦é‡æ–°é‡è§†èµ·æ¥(å¯¹ç‰ˆæœ¬å°½å¯èƒ½å¹¿æ³›ï¼Œè€Œä¸æ˜¯æŸä¸€ç‰¹å®šç‰ˆæœ¬)ï¼Œå¦åˆ™è‡ªåŠ¨å®‰è£…æŸäº›åŒ…ä¼šå’Œé¡¹ç›®ä¸­å­˜åœ¨ç‰ˆæœ¬å†²çªå¯¼è‡´æ•´ä¸ªå®‰è£…è¿›ç¨‹åœæ­¢

å…·ä½“æ¡ˆä¾‹ï¼š[https://github.com/ant-design/ant-design-mobile-rn/issues/1284#issuecomment-1434030736](https://github.com/ant-design/ant-design-mobile-rn/issues/1284#issuecomment-1434030736)
2. **å¼•å…¥**`**workspaces**`**æ¦‚å¿µ**
é¦–ä¸ªå®˜æ–¹æ”¯æŒMonorepoçš„ç‰ˆæœ¬

3. **å¼•å…¥â€œå®‰è£…å¿«ç…§ï¼ˆinstall-time snapshotï¼‰â€æœºåˆ¶**ä¼˜åŒ–å®‰è£…é€Ÿåº¦ï¼Œå‡å°‘ç£ç›˜å’Œç½‘ç»œçš„ä½¿ç”¨

## nodeä¸npmç‰ˆæœ¬æ˜ å°„å…³ç³»
| `**Nodejs**`**ç‰ˆæœ¬** | `**npm**`**ç‰ˆæœ¬** |
| --- | --- |
| 4.x | 2.x |
| 6.x | 3.x |
| 8.x | 5.x |
| 10.x | 6.x |
| 12.x | 6.xæˆ–7.x |
| 14.x | 6.xæˆ–7.x |
| 16.x | 7.x |
| 18.x | 9.x |

## package.jsonâ“


`**peerDependencies**`
ä»npm v7å¼€å§‹é»˜è®¤å®‰è£…`**peerDependencies**`å†…çš„åŒ…
å¦‚æœåŒä¸€åŒ…åæŒ‡å®šçš„ç‰ˆæœ¬ä¸å½“å‰æœ¬åœ°package.jsonå†…çš„ç‰ˆæœ¬ä¸åŒä¼šæŠ¥é”™ã€‚
è§£å†³ï¼š
1.é‡æ–°åˆ¶å®šç‰ˆæœ¬ï¼Œå°½é‡å®½æ¾ä¸è¦ç‰¹å®šæŸä¸€ä¸ªï¼ˆå‰æç¡®å®æ˜¯æ”¯æŒå¤šç‰ˆæœ¬ï¼‰
2.æˆ–è€…`**peerDependenciesMeta**`å†…å…è®¸æ ‡è®°ä¸ºå¯é€‰ã€‚
```diff
// package.json
{
  "dependencies":{
  	"react": "18.x.x",
    "react-yyy": "1.0.0"
  } 
}

// react-yyy@1.0.0
{
  "peerDependencies":{
-    "node": "16 || 17"
+		 "node": ">= 16"
  }
}

// æˆ–è€…peerDependenciesMetaæ ‡è®°ä¸ºå¯é€‰
+ {
+		"peerDependenciesMeta":{
+ 		"node":{
+ 			"optionall": true
+ 		}
+  	}
+ }

```
å½“ç„¶ä¹Ÿæœ‰å¥½å¤„ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‰¹æ€§ï¼Œå¼ºåˆ¶ä½¿ç”¨è€…å‡çº§ã€‚æ¯”å¦‚æ›¾ç»ä¸ºreact-nativeä½ç‰ˆæœ¬åšè¿‡ä¸€äº›ä¸‰æ–¹åŒ…ï¼Œåœ¨react-nativeæ–°ç‰ˆæœ¬ä¸é€‚ç”¨äº†ï¼Œä¹Ÿéœ€è¦ä¸ºæ–°ç‰ˆæœ¬åšæ–°çš„é€‚é…ã€‚è¿™æ—¶è€çš„peerä¾èµ–å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¼ºåˆ¶ç”¨æˆ·æ›´æ–°ã€‚

## package-lock.jsonâ“
> å‚è€ƒï¼š[https://docs.npmjs.com/cli/v9/configuring-npm/package-lock-json](https://docs.npmjs.com/cli/v9/configuring-npm/package-lock-json)

æˆ‘ä»¬çŸ¥é“npmä¸­çš„package.jsonå®‰è£…çš„åŒ…ç»“æ„æˆ–è€…ç‰ˆæœ¬å¹¶ä¸æ˜¯ä¸€å®šä¸€è‡´çš„ï¼Œ
å› ä¸ºpackage.jsonå†™æ³•æ˜¯æ ¹æ® **è¯­ä¹‰ç‰ˆæœ¬æ§åˆ¶ï¼ˆ**`semver`ï¼‰[https://semver.org/](https://semver.org/)

**å…·ä½“ä½œç”¨**ï¼š

- æè¿°ä¾èµ–å…³ç³»æ ‘çš„å•ä¸€è¡¨ç¤ºï¼Œè¿™æ ·å¯ä»¥**ä¿è¯é˜Ÿå‹ã€éƒ¨ç½²å’ŒæŒç»­é›†æˆå®‰è£…å®Œå…¨ç›¸åŒçš„ä¾èµ–å…³ç³»**
- å¯¹node_moduleså¿«ç…§ä½œç”¨ï¼Œå¯ä»¥éšæ„ç©¿è¶Šä¹‹å‰çš„çŠ¶æ€
- æé«˜ä¾èµ–æ ‘å·®å¼‚çš„å¯è¯»æ€§
- å…è®¸npmè·³è¿‡æ‰å¹³åŒ–åµŒå¥—å’Œhoisté‡å¤è§£æè¿‡ç¨‹
- ä»npm v7å¼€å§‹è¿˜èƒ½å‡å°‘å¯¹package.jsonæ–‡ä»¶çš„è¯»å–æ¬¡æ•°

`**version**`

- `5.0.3` è¡¨ç¤ºå®‰è£…æŒ‡å®šçš„`5.0.3`ç‰ˆæœ¬
- `ï½5.0.3` è¡¨ç¤ºå®‰è£…`5.0.X`ä¸­æœ€æ–°çš„ç‰ˆæœ¬ ï¼ˆå¢åŠ **ä¿®è¡¥ç‰ˆæœ¬**ï¼‰
- `^5.0.3` è¡¨ç¤ºå®‰è£…`5.X.X`ä¸­æœ€æ–°çš„ç‰ˆæœ¬ ï¼ˆå¢åŠ **æ¬¡è¦ç‰ˆæœ¬**ï¼‰

`**lockfileVersion**`
**è¡¨ç¤ºç”¨çš„ä»€ä¹ˆç‰ˆæœ¬çš„npmè¿›è¡Œå®‰è£…åŒ…çš„ã€‚**
å› ä¸ºä¸åŒnpmç‰ˆæœ¬ç”Ÿæˆçš„lockæ–‡ä»¶æ ¼å¼ä¸ä¸€æ ·ï¼Œæ¯”å¦‚npm v7åšäº†è¾ƒå¤§çš„æ›´æ–°`**dependencies**`å­—æ®µä¸‹çš„ç»“æ„é‡æ„äº†ï¼Œå¯èƒ½å¯¼è‡´é‡æ–°æ‹‰å–åŒ…çš„ç»“æœä¸ä¸€è‡´ã€‚
**é«˜ç‰ˆæœ¬nodeå…¼å®¹ä½ç‰ˆæœ¬nodeï¼Œä½†æ˜¯ä½ç‰ˆæœ¬nodeä¸å…¼å®¹é«˜ç‰ˆæœ¬**ï¼Œå¯¼è‡´lockfileVersioné«˜äºå½“å‰nodeç‰ˆæœ¬æ—¶å°†ç›´æ¥å¿½ç•¥lockæ–‡ä»¶é‡æ–°æ‹‰å–å’Œç”Ÿæˆã€‚

| **npmç‰ˆæœ¬** | **ç”Ÿæˆ**`**lockfileVersion**` | å‘åå…¼å®¹ |
| --- | --- | --- |
| v5 ã€v6 | 1 | 
 |
| v7ã€v8 | 2 | {lockfileVersion:1}  |
| v9 | 3 | npm v7 |




## yarn
yarnå®‰è£…ä¾èµ–æ­¥éª¤:

1. **æ£€æŸ¥ç³»ç»Ÿè¿è¡Œç¯å¢ƒ**ï¼ŒåŒ…æ‹¬OSã€CPUã€enginesç­‰ä¿¡æ¯
2. **è§£æåŒ…**ï¼š
2.1. **æ”¶é›†é¦–å±‚ä¾èµ–**ï¼šæ ¹æ® `dependencies`ã€`devDxx`ã€`optionalDxx`å½¢æˆé¦–å±‚ä¾èµ–é›†åˆ
ä¹‹åå¯¹åµŒå¥—ä¾èµ–é€çº§è¿›è¡Œé€’å½’è§£æï¼ˆå°†è§£æè¿‡å’Œæ­£åœ¨è§£æçš„åŒ…ç”¨ä¸€ä¸ª`Set`æ•°æ®ç»“æ„å­˜å‚¨ï¼Œä¿é‡åŒä¸€ç‰ˆæœ¬èŒƒå›´å†…çš„åŒ…ä¸ä¼šè¢«é‡å¤è§£æï¼‰
2.2. **é¦–å±‚ä¾èµ–é›†åˆ**ï¼šåˆå¹¶ã€Œ`@`å‰ç¼€çš„åŒ…åã€åŒ…å«npmçš„Organizationså’Œ`workspaces`çš„é¡¶çº§packagesåˆ—è¡¨
3. **è·å–åŒ…**ï¼šç¼“å­˜ ?? `Registry`ä¸‹è½½
4. **é“¾æ¥åŒ…**ï¼šè§£æ`peerDependencies`ä¿¡æ¯ï¼Œä¹‹ååŸºäº**æ‰å¹³åŒ–åŸåˆ™**ï¼ˆä¸åŒäºnpmçš„hoistï¼Œä½¿ç”¨é¢‘ç‡è¾ƒå¤§çš„ç‰ˆæœ¬ä¼šå®‰è£…åˆ°é¡¶å±‚ç›®å½•ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸º`dedupe`ï¼‰
5. **æ„å»ºåŒ…**ï¼šä¾èµ–åŒ…å­˜åœ¨äºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡Œæ„å»ºã€‚
è¿™ä¸ªè¿‡ç¨‹ä¼šæ‰§è¡Œinstallç›¸å…³é’©å­ï¼ˆpackage.jsonçš„`scripts`é…ç½®é¡¹ï¼‰ï¼Œ
åŒ…æ‹¬`preinstall`ã€`install`ã€`postinstall`ã€‚

yarnå¯¹äºnpmçš„ä¼˜åŠ¿ï¼š

1. **å¹¶è¡Œå®‰è£… ğŸš©**
npmæŒ‰åŒ…é¡ºåºæ‰§è¡Œä¸‹è½½ï¼Œå³ä¸€ä¸ªåŒ…å®‰è£…å®Œï¼Œæ‰ä¼šå®‰è£…ä¸‹ä¸€ä¸ªâš ï¸
è€Œyarné€šè¿‡å¹¶è¡Œæ“ä½œä¸‹è½½å®‰è£…ï¼ˆ`npm3`ä¹‹åä¹Ÿå®ç°äº†å¹¶è¡Œå®‰è£…ï¼‰

## pnpm
`pnpm`ä»£è¡¨performantï¼ˆé«˜æ€§èƒ½çš„ï¼‰`npm`ã€‚

pnpmçš„ä¼˜åŠ¿ï¼š

1. **linkæœºåˆ¶**
ä»npmå’Œyarnçš„å®‰è£…ä¾èµ–æ­¥éª¤ä¸­å¯ä»¥çœ‹å‡ºï¼Œè™½ç„¶æœ‰ç¼“å­˜ä½†è¿˜æ˜¯ä¼šå¤åˆ¶ä¸€ä»½åˆ°é¡¹ç›®çš„node_modulesæ–‡ä»¶å¤¹ã€‚

è€Œpnpmé€šè¿‡`hard link`ï¼ˆç¡¬é“¾æ¥ï¼Œæºæ–‡ä»¶çš„å‰¯æœ¬ï¼‰åœ¨å…¨å±€storeé‡Œå­˜å‚¨é¡¹ç›®node_modulesæ–‡ä»¶çš„hard linkç¡¬é“¾æ¥ï¼Œä¸åŒé¡¹ç›®å¯ä»¥ä»å…¨å±€storeå¯»æ‰¾åˆ°åŒä¸€ä¸ªä¾èµ–ï¼Œå¤§å¤§èŠ‚çœäº†ç£ç›˜ç©ºé—´ã€‚

é¡¹ç›®ä¸­ node_modulesé‡Œåˆ™ç”Ÿæˆä¸€ä»½ `.pnpm` é‡Œé¢å­˜å‚¨`symbolic link`ï¼ˆè½¯é“¾æ¥ï¼Œå¿«æ·æ–¹å¼ï¼‰
2. æœ€å¤§ä¼˜ç‚¹æ˜¯**èŠ‚çœç£ç›˜ç©ºé—´ï¼Œç‰¹åˆ«æ˜¯å¤šé¡¹ç›®å¤ç”¨**
æœ¬åœ°æ–‡ä»¶ä¹Ÿä¸å­˜åœ¨å¹½çµä¾èµ–ã€ä¾èµ–åˆ†èº«
![image.png](https://cdn.nlark.com/yuque/0/2023/png/674941/1683864026431-c0de4575-8502-48c8-b9b0-aa38ea633923.png#averageHue=%2326292d&clientId=ud141085a-e520-4&from=paste&height=385&id=u70cb3908&originHeight=385&originWidth=317&originalType=binary&ratio=1&rotation=0&showTitle=false&size=36650&status=done&style=none&taskId=ud8e67553-24e9-448e-8440-8bf58c497b6&title=&width=317)

pnpmçš„ä¸è¶³ä¹‹å¤„ï¼š

1. å…¨å±€hardlinkå¯¼è‡´`postinstall`**ä¿®æ”¹ä¾èµ–ä»£ç **ï¼Œä¼šç”Ÿæ•ˆåˆ°å…¶ä»–æ‰€æœ‰å¼•ç”¨è¿‡å®ƒçš„é¡¹ç›®å¯¼è‡´å‡ºç°ä¸å¯æ§é—®é¢˜ã€‚
2. **è½¯é“¾æ¥å…¼å®¹æ€§ï¼š**ä¸æ”¯æŒè½¯é“¾æ¥çš„ç¯å¢ƒå°±æ— æ³•ä½¿ç”¨pnpmï¼Œæ¯”å¦‚Electronåº”ç”¨
3. éæ‰å¹³åŒ–ç ´åæ€§çš„ç»“æ„å’Œå¿…é¡»ä½¿ç”¨è‡ªèº«é”æ–‡ä»¶`pnpm-lock.yaml`ï¼Œç»™**è¿ç§»å¸¦æ¥æˆæœ¬**

å¦‚ä½•è¿ç§»ï¼š

1. åˆ é™¤node_modules
2. ç›´æ¥æ‰§è¡Œ`pnpm i`
3. æ‰§è¡Œ `pnpm dev`ï¼Œçœ‹æ§åˆ¶å°æŠ¥é”™å“ªä¸ªåŒ…ç¼ºå¤±ï¼Œå†è¡¥ç»™package.jsonï¼ˆè§£å†³å¹½çµä¾èµ–ï¼‰
# dependencies

- `**dependencies**`
- AåŒ… 

```
 {
  "name":"react-native-aaa",
  "dependencies": {
    "aaa": "2.x",
  }
 }
```

- æˆ‘çš„package.json 

```
 {
  "dependencies": {
    "react-native-aaa": "latest",
    "aaa": "1.x" //æˆ–è€…3.x
  }
 }
```

- **ç»“æœï¼š** 

```
 ï½œ--- aaa@1.x|æˆ–è€…3.x
 ï½œ--- react-native-aaa@latest
   ï½œ--- aaa@2.x
```

ä¸€åˆ‡ä»¥ç”¨æˆ·è‡ªå·±çš„`package.json`ä¼˜å…ˆ

-  `**devDependencies**` 
   - â€œdependenciesâ€:ç”Ÿäº§ç¯å¢ƒä¾èµ–åŒ…
   - â€œdevDependenciesâ€:ä»…æœ¬åœ°å¼€å‘å’Œæµ‹è¯•ä¾èµ–åŒ…

```
 {
   "dependencies": {
     "my-dep": "^1.0.0",
     "another-dep": "~2.2.0"
   },
   "devDependencies" : {
     "my-test-framework": "^3.1.0".
     "another-dev-dep": "1.0.0 - 1.2.0"
   }
 }
```

-  `**peerDependencies**`
   é’ˆå¯¹`dependencies`å¯èƒ½ä¼šå‡ºç°ä»¥ä¸‹é—®é¢˜ï¼š
   1.ä¾èµ–ç›¸åŒçš„åŒ…å¯¼è‡´é‡å¤åŠ è½½(è¿™æ˜¯ä¸»è¦çš„ï¼Œç‰¹åˆ«æ˜¯åœ¨RNé‡Œçš„viewmanagerä¼šé‡å¤æ³¨å†Œå¯¼è‡´æŠ¥é”™)
   2.åœ¨npm1å’Œ2çš„ç‰ˆæœ¬ä¸­ï¼ŒpeerDependenciesæ˜¯ä¼šè¢«è‡ªåŠ¨å®‰è£…çš„ï¼Œä½†æ˜¯åœ¨3çš„ç‰ˆæœ¬ä¸­åªä¼šæœ‰è­¦å‘Š  

```
 {
   "name": "react-native-aaa",
   "peerDependencies": {
     "aaa": "2.x"
   }
 }
```

## **yarnä¸npmçš„hoisté€»è¾‘**

> `hoist`ï¼šç‰ˆæœ¬ä¸å†²çªçš„åŒ…ä¼šè¢«å°½å¯èƒ½åœ°ç§»åˆ°ä¸Šå±‚


-  **less-loader**
   åœ¨peerDependenciesä¸­ä¾èµ–äº†less[@3.x ](/3.x )   

```
{
  name:"less-loader",
  "peerDependencies":{
    "less":"3.x"
  }
}
```

-  **self-webpack-config**
   æˆ‘ä»¬è‡ªå·±å»æäº†ä¸€ä¸ªnpmåŒ…,éœ€è¦ä¾èµ–äº†`less-loader`ï¼Œç”±äº`leass-loader`å†…éƒ¨çš„peerDependenciesæœ‰`less`ï¼Œ
   æˆ‘ä»¬æœ‰2ç§æ–¹å¼æ¥è®©nodeä¸‹è½½ 
   1. **ç”±peerDependenciesè‡ªå¸¦çš„æç¤ºè­¦å‘Šå®‰è£…ï¼ˆè¿™ç§æç¤ºä¼šå¢åŠ ä½¿ç”¨æˆæœ¬ï¼‰** 

```
{
  name:"self-webpack-config",
  "dependencies":{
    "less-loader":"latest"
  }
}
```

      2. **åœ¨dependenciesä¸­ä¸»åŠ¨æ›¿ç”¨æˆ·å»æ˜¾å¼å®‰è£…**`**less@3.x**` 

```diff
{
  name:"self-webpack-config",
  "dependencies":{
    "less-loader":"latest",
+    "less":"3.x" //æ˜¾å¼å®‰è£…
  }     
}
```

-  **package.json**ç”¨æˆ·ç«¯
   å› ä¸ºç”¨æˆ·ç”¨ä½ çš„`self-webpack-config`ä¸çŸ¥é“ä¾èµ–äº†`less-loader`ï¼Œ
   ç”±äºå…¶ä»–ä¸šåŠ¡éœ€è¦å®‰è£…`less`ï¼Œç‰ˆæœ¬è¿˜æ¯”è¾ƒä½  

```
{
  "dependcies":{
    "self-webpack-config":"latest",
    "less":"2.x" //ä½†æ˜¯æ²¡æƒ³åˆ°ç”¨æˆ·ä¹Ÿå®‰è£…äº†lessï¼Œç‰ˆæœ¬è¿˜æ¯”è¾ƒä½
  }
}
```

-  **node-modules**
   ç»“æœå¯¼è‡´`less-loader`å†…å¼•ç”¨çš„æ˜¯`less@2.x` è€Œä¸æ˜¯self-webpack-configé‡Œçš„`less@3.x`  

```
ï½œ--- less@2.x    //ç”¨æˆ·è‡ªå·±å®‰è£…çš„less@2.x
ï½œ--- less-loader //self-webpack-configé‡Œçš„æ˜¾å¼åŒ…less-loaderä¼šè¢«æä¸Šæ¥(æ­£å¸¸)
ï½œ--- self-webpack-config
   ï½œ--- less@3.x  //ç”±äºlessä¸ç”¨æˆ·è‡ªå·±å®‰è£…çš„å†²çªï¼Œæ‰€ä»¥è¢«æ”¾åœ¨è¿™é‡Œ
```

-  **ğŸš©å¦‚ä½•è§£å†³ï¼Ÿ** 
   1. **å¦‚æœæ˜¯ä½ åœ¨å¼€å‘npmåŒ…**

å›åˆ°self-webpack-configï¼Œä¸è¦å»â€œå¸®ç”¨æˆ·â€å®‰è£…peerä¾èµ–ï¼Œè€Œæ˜¯åœ¨è‡ªå·±çš„package.jsonä¸­åŠ ä¸Šç›¸åŒçš„peerDependencies,
åˆ©ç”¨terminalå¼¹è­¦å‘Šè¯·æœ€ç»ˆç”¨æˆ·æ¥æ»¡è¶³è¿™äº›ä¾èµ–
`{ name:"self-webpack-config", "dependencies":{ "less-loader":"latest" }, "peerDependencies":{ "less":"3.x.x" } }`2.**å¦‚æœä½ ç”¨åˆ«äººçš„åŒ…ç¢°åˆ°è¿™ç§é—®é¢˜**å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„npm 7.x / yarn[@latest ](/latest )

> ç»“è®ºï¼š
> **å¦‚æœæ˜¯ä½ åœ¨å¼€å‘npmåŒ…**ï¼Œä¸è¦å»â€œå¸®ç”¨æˆ·â€å®‰è£…peerä¾èµ–ï¼Œè€Œæ˜¯åœ¨è‡ªå·±çš„package.jsonä¸­åŠ ä¸Šç›¸åŒçš„peerDependencies,
> **å¦‚æœä½ ç”¨åˆ«äººçš„åŒ…ç¢°åˆ°è¿™ç§é—®é¢˜** ,è¯·å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„npm 7.x / yarn[@latest ](/latest ) 


## semver è¯­ä¹‰åŒ–ç‰ˆæœ¬ 

semverï¼ŒSemantic Versioning è¯­ä¹‰åŒ–ç‰ˆæœ¬çš„ç¼©å†™ï¼Œæ–‡æ¡£å¯è§ [https://semver.org/(opens new window)](https://semver.org/)ï¼Œå®ƒç”± [`major`, `minor`, `patch`] ä¸‰éƒ¨åˆ†ç»„æˆï¼Œå…¶ä¸­

- `major`: å½“ä½ å‘äº†ä¸€ä¸ªå«æœ‰ Breaking Change çš„ API
- `minor`: å½“ä½ æ–°å¢äº†ä¸€ä¸ªå‘åå…¼å®¹çš„åŠŸèƒ½æ—¶
- `patch`: å½“ä½ ä¿®å¤äº†ä¸€ä¸ªå‘åå…¼å®¹çš„ Bug æ—¶

| ä»£ç çŠ¶æ€                 | é˜¶æ®µ            | å®ä¾‹ç‰ˆæœ¬ |
| ------------------------ | --------------- | -------- |
| åˆç‰ˆRelease              | æ–°äº§å“è¯·ä»1å¼€å§‹ | `1.0.0`  |
| å‘åå…¼å®¹çš„**é”™è¯¯ä¿®å¤**   | è¡¥ä¸å‘å¸ƒ        | `1.0.1`  |
| å‘åå…¼å®¹çš„**æ–°åŠŸèƒ½**     | è½»å¾®é‡Šæ”¾        | `1.1.0`  |
| æ›´æ”¹ä¼š**ç ´å**å‘åå…¼å®¹æ€§ | ä¸»è¦å‘è¡Œ        | `2.0.0`  |


## version

```json
  {
    "dependencies": {
      "chai": "~version",
      "chai": "^version",
      "chai": "<version"
    }
  }
```

-  `ï½version`**å¤§çº¦ç­‰æ•ˆäºç‰ˆæœ¬**
   å°†åœ¨**ä¸å¢åŠ æ¬¡è¦ç‰ˆæœ¬**çš„æƒ…å†µä¸‹å°†æ›´æ–°æ‰€æœ‰å°†æ¥çš„ä¿®è¡¥ç¨‹åºç‰ˆæœ¬ã€‚ä¾‹å¦‚ï¼š`**~1.2.3**`å°†ä½¿ç”¨ä»`1.2.3`åˆ°`<1.3.0`çš„å‘è¡Œç‰ˆæœ¬ 
-  `^version`**ä¸ç‰ˆæœ¬å…¼å®¹**
   æ›´æ–°åˆ°**æ‰€æœ‰**å°†æ¥çš„æ¬¡è¦/è¡¥ä¸ç‰ˆæœ¬ï¼Œè€Œæ— éœ€å¢åŠ ä¸»è¦ç‰ˆæœ¬ã€‚ä¾‹å¦‚:`**^2.3.4**`å°†ä½¿ç”¨ä»`2.3.4`åˆ°`<3.0.0`çš„å‘è¡Œç‰ˆ 
-  `<version`**å°äºå½“å‰ç‰ˆæœ¬** 

> ä¸¾ä¸ªä¾‹å­ï¼šå‡å¦‚ä½ æœ‰ä¸€ä¸ªåŒ…3ä¸ªç‰ˆæœ¬`0.0.1`,`0.0.2`å’Œ`0.0.3`ã€‚`0.0.1`æœ‰ä¸€ä¸ªbug,å› æ­¤éœ€è¦è‡³å°‘`0.0.2`ç‰ˆæœ¬ã€‚
> å¦‚æœæ‚¨ç¼–å†™`0.0.x`å°†å¾—åˆ°`0.0.3`ï¼Œä½†æ˜¯å¦‚æœæœ‰ä¸€ä¸ªåŒ…å¿…é¡»éœ€è¦`0.0.2`
> å¦‚æœæ‚¨ç¼–å†™`<0.0.2`å°†å¾—åˆ°`0.0.1`ä¸ä¼šå†²çªä½†ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„
> æ‰€ä»¥`~0.0.2`å¯ä»¥å¸®åŠ©åˆ°æˆ‘ä»¬


# 
