# å°ç¨‹åºè¸©å‘è®°å½•

1. **æ³¨æ„ **å°ç¨‹åºä¸è‡ªå¸¦touch scroll, éœ€è¦ç”¨åˆ°`**<scroll-view>**`ç»„ä»¶
2. **æ³¨æ„**`computed`ä¸æ˜¯è‡ªèº«apiï¼Œæ˜¯`behaviors:[miniprogram-computed]`å®ç°çš„
3. **å…³äºç²—ä½“**ï¼šéƒ¨åˆ†æ‰‹æœº`font-weight`ä¸æ”¯æŒæ•°å­—å€¼ï¼Œè¦ç”¨`**bold**`
4. **å»ºè®® **`wx:if`ä¸è¦å’Œ`wx:for`åœ¨ä¸€ä¸ªæ ‡ç­¾å†…åŒæ—¶ä½¿ç”¨ï¼ŒåŸå› :forä¼˜å…ˆçº§é«˜äºif
5. **æ³¨æ„ **`dataset`é‡åˆ°**å­—æ¯**ä¼šè¢«å¼ºåˆ¶è½¬ä¸º**å°å†™ï¼Œ**é‡åˆ°`**-**`ä¼šä»¥**é©¼å³°**çš„å½¢å¼æ‹¼æ¥**ï¼ˆç»§æ‰¿HTMLï¼‰**
6. ä¸è¦å†ç”Ÿå‘½å‘¨æœŸå†…ç›‘å¬æ•°æ®å˜åŒ–
```javascript
Component({
  properties: {
    order: { // å­˜åœ¨æ·±å±‚æ•°æ®
       type: Object,
       value: {},
       observer:'handleOrderChange' // ovserverç®€å†™
    }
  },
  data: {
    order: {}, // å°†propertyçš„æ•°æ®æ³¨å†Œåˆ°æœ¬ç»„ä»¶çš„dataå†…(å¯çœç•¥ï¼Œå› ä¸ºç»„ä»¶ä¸€èˆ¬ä¸å¯¹ä¼ å…¥çš„å€¼åšä¿®æ”¹)
  }ï¼Œ
  attached(){
     this.update(); // æ—¥å¸¸æ“ä½œ
  },
  pageLifetimes: {
    show(){}, // ä¸€èˆ¬ä¸å†™åœ¨showå†…
    // å› ä¸ºæ¯”å¦‚è¿”å›é¡µé¢ååˆ·æ–°ï¼Œè¿™æ˜¯showæ¯”æ•°æ®æ”¹å˜è¦å¿«ä¸€äº›ï¼Œæ‰€ä»¥åœ¨showå†…æ‹¿åˆ°çš„æ•°æ®å…¶å®è¿˜æ˜¯æ—§æ•°æ®
  },
  observers: {
    order() {
       this.update(); //ğŸŒŸä½¿ç”¨observer
    }
  },
  // å“åº”orderçš„æ›´æ–°
  handleOrderChange(val){...}
})
```
```javascript
const computedBehavior = require('miniprogram-computed');

// Pageéœ€è¦æ³¨å†Œ
Page({
  behaviors: [computedBehavior],
  watch: {
    detail(val) {
      console.log(val);
    },
  },
})

// ç»„ä»¶è‡ªå¸¦observers
Component({
  observers: {
    order() {
       this.update(); //ğŸŒŸä½¿ç”¨observer
    }
  },
})
```
# å¾®ä¿¡å°ç¨‹åºç¼–è¾‘å™¨å·¥å…·

1.  **æŸ¥çœ‹æ‰“åŒ…ååŒ…å¤§å°**
è¯¦æƒ… > æœ¬åœ°ä»£ç  > ä»£ç ä¾èµ–åˆ†æ 
2.  **ä½“éªŒè¯„åˆ†å°ç¨‹åºä»£ç **
è°ƒè¯•å™¨ > Audits 

# åŒ…å¤§å°ä¼˜åŒ–

## ç»å…¸Q&A

- `Q`ï¼šä»£ç é™æ€åˆ†æä¸­çš„â€œæ— ä¾èµ–ä»£ç æ–‡ä»¶â€ä¼šä¸ä¼šè¢«æ‰“åŒ…è¿›å»ï¼Ÿ
- `A`ï¼šä¸ä¼š
- 

- `Q`ï¼šä»€ä¹ˆæ˜¯**ä¸»åŒ…**ï¼Ÿ
- `A`ï¼šæ‰€è°“çš„**ä¸»åŒ…**ï¼Œå³æ”¾ç½®é»˜è®¤å¯åŠ¨é¡µé¢/TabBaré¡µé¢ï¼Œä»¥åŠ**ä¸€äº›æ‰€æœ‰åˆ†åŒ…éƒ½éœ€ç”¨åˆ°çš„å…¬å…±èµ„æº/JSè„šæœ¬ï¼Œ
        âš ï¸ä»¥æ–‡ä»¶å¤¹ç›®å½•æ‰“åŒ…çš„ï¼Œä¸æ”¾åœ¨åˆ†åŒ…é‡Œçš„éƒ½ä¼šæ‰“åŒ…åˆ°ä¸»åŒ…**
- 

- `Q`ï¼šå°ç¨‹åºåˆ†åŒ…åçš„å¼•ç”¨åŸåˆ™ï¼Ÿ
- `A`ï¼šå­åŒ…Aä¸å­åŒ…Bä¹‹é—´çš„èµ„æºä¸èƒ½äº’ç›¸import,ä½†å¯ä»¥ä½¿ç”¨ä¸»åŒ…appã€è‡ªå·±packageå†…çš„èµ„æº[ğŸ”—](https://developers.weixin.qq.com/miniprogram/dev/framework/subpackages/basic.html#%E5%BC%95%E7%94%A8%E5%8E%9F%E5%88%99)
- 

- `Q`ï¼šä»€ä¹ˆæ˜¯**ç‹¬ç«‹åˆ†åŒ…**ï¼Ÿ
- `A`ï¼š**ç‹¬ç«‹åˆ†åŒ…**å±äºåˆ†åŒ…çš„ä¸€ç§ï¼Œä½†ç‹¬ç«‹åˆ†åŒ…ä¸èƒ½ä¾èµ–ä¸»åŒ…å’Œå…¶ä»–åˆ†åŒ…ä¸­çš„å†…å®¹,åŒ…æ‹¬app.xxå’Œ`getApp()`ã€æ’ä»¶
å¯ä»¥åˆ©ç”¨`"independent"`é…ç½®ç‹¬ç«‹åŒ…ï¼Œ`"preloadRule"`é…ç½®é¢„ä¸‹è½½å‡è½»ä¸»åŒ…å†…éƒ¨åˆ†ä¸ä¼šç«‹é©¬ä½¿ç”¨çš„é¡µé¢
- 

- `Q`ï¼š**å°ç¨‹åºä¸Šä¼ ä»£ç æ—¶ä¼šä¸ä¼šè‡ªåŠ¨å‹ç¼©ï¼Ÿ**
- `A`ï¼šå¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­è‡ªå¸¦babelå°†ES6è½¬ES5ã€æ ·å¼è¡¥å…¨ä»¥åŠjsä»£ç å‹ç¼©ç­‰åŠŸèƒ½ï¼Œæ‰€ä»¥åŒ…æ‹¬gulpå·¥ä½œæµä¸éœ€è¦é¢å¤–å»åš
- `A2`ï¼š`yarn.lock`ã€`.scss`ã€`.ts`æ–‡ä»¶å¤©ç”Ÿè¢«å¿½ç•¥,ä½†`package-lock.json`ä¸ä¼š
- `A3`ï¼šğŸš©**ä½†æ˜¯åœ¨å¼€å‘è€…å·¥å…·ä¸­ä¸Šä¼ ä»£ç æ—¶è®¡ç®—ä½“ç§¯æ˜¯ç›´æ¥è®¡ç®—çš„å½“å‰é¡¹ç›®çš„ä½“ç§¯ï¼Œå¹¶ä¸ä¼šä¾æ®å‹ç¼©åçš„ä»£ç **
- 

- `Q`**ï¼šğŸš©èµ„æºåˆ†åŒ…ç­–ç•¥ï¼Ÿ**
- `A`**ï¼šå…³äºå…¬å…±èµ„æºè·¯å¾„ï¼Œå¦‚æœå¤šä¸ªåˆ†åŒ…éƒ½ä¼šç”¨åˆ°ï¼Œå³ä½¿ä¸»åŒ…ä¸ç”¨ä¹Ÿä¼šæ‰“åŒ…è¿›å…¥ä¸»åŒ…**
- **        æ‰€ä»¥ä¸€å¼€å§‹æ–°å»ºçš„ç»„ä»¶æˆ–å·¥å…·ç±»ä»£ç å…ˆæ”¾åœ¨åˆ†åŒ…é‡Œï¼Œ**
- **        å¦‚æœå…¶ä»–åˆ†åŒ…ä¹Ÿéœ€è¦çš„æ—¶å€™ï¼Œå†æ”¾åˆ°å…¬å…±èµ„æºå†…**
- **        è¿™æ ·å¯ä»¥æ–¹ä¾¿æ„ŸçŸ¥ä¸»åŒ…çš„ä½“ç§¯å˜åŒ–**


## æ ‡å‡†åšæ³•

1. ä½¿ç”¨åˆ†åŒ…
2. å›¾ç‰‡ã€å­—ä½“èµ„æºå¤„ç†ï¼ˆèµ„æºCDNåŒ–ï¼‰
3. **åŠæ—¶æ¸…é™¤æ— ç”¨ä»£ç **
3.1. æ›¿æ¢å®ç°æ–¹æ¡ˆï¼Œç‰¹åˆ«æ˜¯è¦å®ç°ä¸€ä¸ªå°åŠŸèƒ½å´éœ€è¦ä¾èµ–ç‰¹åˆ«å¤§çš„æ–‡ä»¶
3.2. æ¸…é™¤æ— ç”¨css
3.3. ç§»é™¤JSä¸Šä¸‹æ–‡ä¸­çš„æœªå¼•ç”¨ä»£ç ï¼ˆdead-codeï¼‰(æœ¯è¯­Tree shaking )
4. package.jsonåˆç†ä½¿ç”¨`peerDep`æˆ–è€…`devDep`æ¥å£°æ˜ä¸€äº›å…±æœ‰ä¾èµ–ï¼Œé¿å…å› ç‰ˆæœ¬ä¸åŒè£…å‡ºä¸¤ä»½å…¬å…±ä¾èµ–
5. èµ„æºæ–‡ä»¶è¦æ”¾åœ¨åˆé€‚çš„ä½ç½®ğŸŒŸ

### miniprogram-npmåŒ…ä¼˜åŒ–
> **å°½å¯èƒ½ä½¿ç”¨ç›¸åŒç‰ˆæœ¬çš„ä¾èµ–**

```
miniprogram-npm
  â”œâ”€decode-uri-component
  |    â””â”€â”€â”€â”€â”€â”€index.js --> compress => 2.21KB
  â”œâ”€query-string
  |    â””â”€â”€â”€â”€â”€â”€index.js --> compress => 4.27KB
  â”œâ”€split-on-first
  |    â””â”€â”€â”€â”€â”€â”€index.js --> compress => 1.02KB
  â””â”€strict-uri-encode
       â””â”€â”€â”€â”€â”€â”€index.js --> compress => 0.82KB
```

å‚è€ƒï¼š[https://blog.newfuture.cc/reduce-miniprogram-package-size/](https://blog.newfuture.cc/reduce-miniprogram-package-size/)

### 
## 

# æ€§èƒ½ä¸ä½“éªŒ
> å¹¿ä¹‰ä¸Šè®²ï¼Œå°ç¨‹åºçš„æ€§èƒ½åˆå¯ä»¥åˆ†ä¸ºã€Œ**å¯åŠ¨æ€§èƒ½**ã€å’Œã€Œ**è¿è¡Œæ—¶æ€§èƒ½**ã€

## å¯åŠ¨æ€§èƒ½

1. å°ç¨‹åºçš„å¯åŠ¨è¿‡ç¨‹ä»¥ã€Œç”¨æˆ·æ‰“å¼€å°ç¨‹åºã€ä¸ºèµ·ç‚¹ï¼Œåˆ°å°ç¨‹åºã€Œé¦–é¡µæ¸²æŸ“å®Œæˆã€ä¸ºæ­¢ï¼Œ
ğŸš©ç”±`Page.onReady`äº‹ä»¶è§¦å‘
2. **æ‰“å¼€ç‡** = ã€Œé¦–æ¬¡æ¸²æŸ“å®Œæˆã€æ¬¡æ•°ä¸ã€Œå°ç¨‹åºå¯åŠ¨ã€æ¬¡æ•°çš„æ¯”å€¼ï¼ˆä¹Ÿè¢«ç§°ä¸º**PV**ï¼‰
## è¿è¡Œæ—¶æ€§èƒ½

1. åˆç†ä½¿ç”¨`setData`
2. **æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–**
3. **é¡µé¢åˆ‡æ¢ä¼˜åŒ–**
4. **èµ„æºåŠ è½½ä¼˜åŒ–**ï¼šå›¾ç‰‡é¢„å…ˆæŒ‡å®šå°ºå¯¸
5. **å†…å­˜ä¼˜åŒ–**ï¼šåŠæ—¶æ¸…ç†å…¨å±€å˜é‡å’Œäº‹ä»¶è§£ç»‘

## ä¼˜åŒ–æ¡ˆä¾‹
> æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–

### å€’è®¡æ—¶ç»„ä»¶ CSS contain

1. å€’è®¡æ—¶ç»„ä»¶å°è£…ä¸º**ç‹¬ç«‹çš„ç»„ä»¶**ï¼Œç‹¬ç«‹`setData`
2. é¿å…é¡µé¢åˆ‡æ¢**åå°åé¿å…æ›´æ–°**ï¼Œåº”è¯¥åœ¨onShowå’Œ`onHide`ä¸­æ¥å›åˆ‡æ¢å€’è®¡æ—¶çš„è®¡ç®—
3. ä½¿ç”¨**CSS contain**é™åˆ¶è®¡ç®—å¸ƒå±€ã€æ ·å¼å’Œç»˜åˆ¶ç­‰çš„èŒƒå›´ï¼Œ**å‡å°‘é‡ç»˜**

### setDataæ”¯æŒå¯¹è±¡æ·±å±‚æ•°æ®è·¯å¾„
é¿å…æ•´ä¸ªå¯¹è±¡æˆ–æ•°ç»„æ›´æ–°
```javascript
this.setData({
  'array[2].name': 'Niko',
  'a.b.c.d': 'val'
})
```

### ä¸‹æ‹‰åˆ·æ–°ç»„ä»¶

1. **Page
**æ³¨å†Œï¼š`**Page**(Object.assign(**pageConfig**, **listPull**))`**listPullï¼šç›‘å¬`onReachBottom`æ–¹æ³•

2. **Component
**æ³¨å†Œ**ï¼š**`behaviors: [listPull],`
listPullï¼šåŒPage

3. <**scroll-view>**åŸç”Ÿç»„ä»¶
ç›‘å¬ï¼š`bindscrolltolower`

4. é¿å…ç©ºç›‘æ§`onScroll`
```javascript
Page({
  onPageScroll () {} // âŒä¸è¦ä¿ç•™ç©ºå‡½æ•°
})
```

### é¿å…onHide/onUnloadæ‰§è¡Œè€—æ—¶æ“ä½œ
> é¡µé¢åˆ‡æ¢ä¼˜åŒ–

1. è‹¥å¿…é¡»æ“ä½œï¼Œå¯ä»¥è€ƒè™‘ç”¨setTimeoutå»¶è¿Ÿæ“ä½œ
2. é¿å…ä½¿ç”¨åŒæ­¥æ¥å£è°ƒç”¨ã€setDataç­‰

### app.json

1. ä»£ç æŒ‰éœ€æ³¨å…¥ä¼˜åŒ–ï¼š`lazyCodeLoading: requireComponents`
2. æ§åˆ¶é¢„åŠ è½½ä¸‹ä¸€ä¸ªé¡µé¢ï¼š`"window": {  "handleWebviewPreload": "auto"  }`
# äº‹ä»¶ç»‘å®š

> åœºæ™¯ï¼šä¸ºå·²å°è£…å¥½çš„ç»„ä»¶æ·»åŠ ç‚¹å‡»äº‹ä»¶æ‹¦æˆªhookï¼Œä½¿å¾—ä¹‹å‰çš„ç‚¹å‡»äº‹ä»¶æ— æ•ˆå¹¶æ‰§è¡Œhookäº‹ä»¶


-  **è§£å†³æ–¹æ¡ˆ1:é˜»æ­¢äº‹ä»¶æ•è·**
ç†è®ºä¸Šåˆ©ç”¨`capture-catch`åœ¨æœ€å¤–éƒ¨æ·»åŠ é˜»æ­¢äº‹ä»¶æ•è·çš„äº‹ä»¶ï¼Œä»¥æ­¤æ‹¦æˆª
**ä¼˜åŠ¿**ï¼šæ‹“å±•æ€§æå¼ºã€ä¸”æ— éœ€ä¿®æ”¹å†…éƒ¨ä»£ç ï¼Œåˆ©äºç»´æŠ¤
**ç¼ºç‚¹**ï¼šä¸èƒ½åŠ¨æ€`bind/catch`ï¼Œæ‰€ä»¥ä¸€æ—¦è®¾ç½®é˜»æ­¢å°±æ°¸è¿œä¸èƒ½ä¿®æ”¹ 
-  **è§£å†³æ–¹æ¡ˆ2ï¼šç›‘å¬äº‹ä»¶**
`<component bindcustomer="myevent" />`
**ç¼ºç‚¹**ï¼šä¸èƒ½å¤šçº§ç›‘å¬ï¼Œå±‚çº§åªèƒ½æ˜¯ä¸€å±‚ 
-  **è§£å†³æ–¹æ¡ˆ3:å…¨å±€äº‹ä»¶æ¨¡å‹**
`eventTarget`
**ç¼ºç‚¹**ï¼šä¸èƒ½ä½¿ç”¨å›è°ƒæ¨¡å¼ï¼Œå³ä½¿ä¼ é€’å›è°ƒå‡½æ•°ï¼Œä¸èƒ½ä¿å­˜å‡½æ•°å†…çš„thisåŸå€ 

# WXMLè¯­æ³•

-  æ•°æ®ç»‘å®šä¸æ”¯æŒå‡½æ•°  
```xml
<view data-set="{{array.slice()}}" /> // ä¸æ”¯æŒ
```

-  ä½¿ç”¨computedè®¡ç®—  
```javascript
const computedBehavior = require('miniprogram-computed');

const pageConfig = {
  behaviors: [computedBehavior],
  computed: {
    sum(data){ // <text>{{sum}}</text>
      return data.a + data.b
    }
  }
}
```

# å°ç¨‹åºä¸­ä½¿ç”¨lodash

> å‚è€ƒï¼š[https://cnodejs.org/topic/5846b2883ebad99b336b1e06](https://cnodejs.org/topic/5846b2883ebad99b336b1e06)


```bash
Uncaught TypeError: Cannot read property 'prototype' of undefined
```

åŸå› ï¼š`Array` ä¸å­˜åœ¨, å› ä¸º `freeGlobal` å’Œ `freeSelf` éƒ½ä¸º `false`, å› ä¸ºå¾®ä¿¡ç›´æ¥æ³¨å…¥äº† `window` å’Œ `self`;

```
define("utils/vendor/lodash/lodash.js", function(require, module, exports, ã€windowã€‘, document, frames, ã€selfã€‘){

})
```

è§£å†³æ–¹æ¡ˆï¼š

```
npm install lodash.get
```

æˆ–è€…

```
lodash modularize
```

# åœ¨ wxs ä¸­æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼

> é—®é¢˜ï¼š[https://developers.weixin.qq.com/community/develop/doc/2d576edc8b3534ff8d74bea739c06c41](https://developers.weixin.qq.com/community/develop/doc/2d576edc8b3534ff8d74bea739c06c41)
è§£å†³æ–¹æ¡ˆï¼š[https://developers.weixin.qq.com/miniprogram/dev/reference/wxs/06datatype.html#regexp](https://developers.weixin.qq.com/miniprogram/dev/reference/wxs/06datatype.html#regexp)


```xml
<wxs>
  module.exports = {
    getContent: function(value){
      return value.replace(/\s+/g, '') // åœ¨wxsä¸­  \ã€/  ä¹‹ç±»çš„å­—ç¬¦æ˜¯ä¸æ”¯æŒçš„ 
    }
  }
</wxs>
```

è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨`getRegExp()`ï¼Œç±»ä¼¼`new RegExp(reg, option)`æ›¿ä»£

```
   return value.replace(getRegExp('\s+', 'g'), '')
```

# bindTap + DataSet ç®€å†™
> âš ï¸`dataset`åœ¨`wxml`é‡Œçš„**å¤§å†™**åˆ°jsä¸­ä¼šè¢«å¼ºåˆ¶è½¬ä¸º**å°å†™**

> âš ï¸`dataset`åœ¨`wxml`é‡Œçš„`**-**`ç¬¦å·åˆ°jsä¸­ä¼šè¢«å¼ºåˆ¶è½¬ä¸º**é©¼å³°**

```
    // .wxml
    <view 
      bindtap="onTapItem"
      data-Item="item"
      data-Index="index"
    />
    
    // .js
    
    // è€æ¬¾
    onTapItem(e){
      const { item, index } = e.currentTarget.dataset;
    }
    
    // ç®€åŒ–
    onTapItem({
      currentTarget: {
        dataset: { item, index }, // âš ï¸æ³¨æ„å…¨éƒ¨ä¼šè¢«å¼ºåˆ¶è½¬ä¸ºå°å†™
      },
    }){
      //...
    }
```

# ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ

[https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/lifetimes.html](https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/lifetimes.html)

ç”Ÿå‘½å‘¨æœŸæ‰§è¡Œé¡ºåº onShow -> create -> setData

```
<Page>
  <Component1 wx:if="{{show}}"/>
  <Component2 />
</Page>
```

åœ¨ç¬¬ä¸€æ¬¡é¡µé¢Pageæ˜¾ç¤º`show`ä¹‹åï¼Œåªæœ‰`Component2`ç»„ä»¶å†…çš„`pageLifetimes.show`ä¼šè¢«æ‰§è¡Œ

# ç»„ä»¶è®¾è®¡

## 1.ç»„ä»¶æ ·å¼å¤–éƒ¨å¦‚ä½•æ§åˆ¶ï¼Ÿ

> å‚è€ƒï¼š[https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/wxml-wxss.html](https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/wxml-wxss.html)


```html
// use
<my-component my-class="must-twoWords" />

<style>
  .must-twoWords {...}
</style>


// my-component design
<view class="my-class">
</view>

<script>
  Component({
    externalClasses: ['my-class']
  })
</script>
```

## 2. æ’æ§½

> [å¾®ä¿¡å®˜æ–¹æ–‡æ¡£custom-component](https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/wxml-wxss.html#%E6%A8%A1%E6%9D%BF%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A)


ä½¿ç”¨`å…·åæ’æ§½`,éœ€è¦æ·»åŠ `multipleSlots: true`

```javascript
Component({
  options: {
    ...
    multipleSlots: true, // å…è®¸å¤šä¸ªslot
  }
})
```

å…·åæ’æ§½

```
// å®šä¹‰
<slot name="title"></slot>

// ä½¿ç”¨
<view slot="title">...</view>
```

## 3. æ ·å¼classè¦†ç›–

`.component-ç»„ä»¶åç§°-index--classname`

```
// dialog component
<view class="dialog">
  <img class="header-img" />
</view>

// parent
<view>
  <dialog class="dialog-box">
</view>

// wxss
.dialog-box {
  .component-dialog-index--header-img {...}
}
```

# mobx-miniprogram-binds
ä½¿ç”¨
```javascript
import {storeBindingsBehavior} from 'mobx-miniprogram-bindings'

{
  behaviors: [storeBindingsBehavior],
  storeBindings: {
    store: storeFile,
    fields: ['dataA','dataB'],
    actions: ['setDataA', 'setDataB']
  }
}
```
å®ç°
```javascript
import {reaction} from 'mobx'

Behaviod({
  definitionFilter: (storeBinding)=>{
    // æ‹¿ç»„ä»¶å®šä¹‰çš„storeBindingå±æ€§
  },
  attached(){},
  detached(){}
})

// ç›‘å¬
reaction(() => store[field], (value) => {
  scheduleSetData(field, value)
}, {
  fireImmediately: true,
})

// æ—¶é—´åˆ‡ç‰‡ï¼Œåˆå¹¶æ›´æ–°
let pendingSetData = null // ğŸŒŸ
function applySetData() {
  if (pendingSetData === null) return
  const data = pendingSetData
  pendingSetData = null
  target.setData(data)
}
function scheduleSetData(field, value) {
  if (!pendingSetData) {
    pendingSetData = {}
    wx.nextTick(applySetData) // ğŸŒŸ
  }
  pendingSetData[field] = value
}
```
# Handle TAP getsture
> å°ç¨‹åºsdkæ˜¯å¦‚ä½•è®¾è®¡åªæœ‰ç”¨æˆ·çš„ç‚¹å‡»äº‹ä»¶æ‰å…è®¸æ‰§è¡Œçš„ï¼Ÿ


æ¡ˆä¾‹ï¼š`openCustomerServiceChat:fail can only be invoked by user TAP gesture`
æ‰“å¼€å¾®ä¿¡å®¢æœï¼Œé¡µé¢äº§ç”Ÿç‚¹å‡»äº‹ä»¶ï¼ˆä¾‹å¦‚ button ä¸Š bindtap çš„å›è°ƒä¸­ï¼‰åæ‰å¯è°ƒç”¨

å°ç¨‹åºè¡¨ç°ï¼š

1. â€¨â€¨åœ¨ setTimeout / wx.nextTickçš„å›è°ƒä¸­è§¦å‘ ä¸å±äºTAP captureâ€¨
2. åœ¨ promiseä¸­è§¦å‘ å¯ä»¥ç®—ä½œ TAP captureâ€¨â€¨

è§¦å‘å…³é”®è¯
Q: js get function call stackâ€¨ï¼ˆå‡½æ•°è°ƒç”¨æ ˆï¼‰
A: `new Error().stack`ğŸŒŸ
```javascript
const wx = {
  openCustomerServiceChat:function({fail,complete}={}){
    try{
      const stack = new Error().stack;
      if(!stack.includes("HTMLButtonElement.onclick")){
        return fail?.("openCustomerServiceChat:fail can only be invoked by user TAP gesture");
      }

      console.log("openCustomerServiceChat:ok")
    }catch(e){
      fail?.(e)
    }finally{
      complete?.()
    }
  }
}
```
# createSelectorQuery
tabsæ»šåŠ¨åˆ°é¡¶éƒ¨
```javascript
setScrollTop() {
  const query = this.createSelectorQuery();
  query.select('#tabs-anchor').boundingClientRect();
  query.selectViewport().scrollOffset();
  query.exec(res => {
    const { top } = res[0];
    const { scrollTop } = res[1];
    if (top < 0) {
      wx.pageScrollTo({ scrollTop: top + scrollTop - 130 });
    }
  });
},
```
